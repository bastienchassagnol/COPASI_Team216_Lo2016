{
  "hash": "d1602b9fab89f9560571c82d9783ee05",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Steady-state computations\"\nformat: html\n---\n\nThe list of packages required for reproducing the analyses on this script are listed in @lst-setup-steady-states: \n\n\n::: {.cell layout-align=\"center\"}\n\n```{#lst-setup-steady-states .r .cell-code  lst-cap=\"Packages required for computing and displaying steady-state conditions.\"}\n# install and load R connector to COPASI software\n# remotes::install_github(\"jpahle/CoRC\")\nlibrary(CoRC)\nlibrary(testthat)\n\n# tidyverse packages\nlibrary(dplyr)\n\n# Table reporting\nlibrary(flextable)\n```\n:::\n\n\n## Run steady-state Analyses\n\nThe call to `CoRC::runSteadyState()` function retrieves the steady-state of the ODE model (see @nte-steady-state for the mathematical definition of steady states).   \n\n\n\n\n```r\nhealthy_model <- loadModel(\"../../models/team_2016_final_model_lo2016_2025_05_13.cps\") # <1>\nhealthy_model_steady_state <- runSteadyState(                               # <2>\n  model = healthy_model,                                                    # <2>  \n  calculate_jacobian = TRUE,                                            # <2>\n  perform_stability_analysis = TRUE,                                        # <2>  \n  method = list(\"use_newton\"=TRUE, accept_negative_concentrations = FALSE)  # <3>\n)\n```\n1. Run `CoRC::loadModel()` function to load the COPASI model in R^[Note that models are loaded **by reference** with the CoRC package, meaning that you modify the object **in place**. Note that his behaviour is rather uncommon in R, the default being the **Copy-on-Modify Behavior** (aka by **value**).]. \n2. We ue the `CoRC::runSteadyState` function to run the steady-states...\n3. ... and for this this, several algorithms can be chosen. We used in our framework the well-known **root-finding** [Newton-Raphson algorithm](https://en.wikipedia.org/wiki/Newton%27s_method).\n\n::: {#nte-steady-state .callout-note title=\"Derive Steady-States Conditions of an ODE model\"}\n\nComputing the **steady-state conditions** for an ordinary differential equation (ODE) means finding the system's *equilibrium points*, where the variables (also named the **species**) remain **constant** over time. In other words, this means finding the concentrations for which all the derivatives cancel:\n\nGiven a system of $n=15$ ODEs (number of varying species in the simulated model),   \n\n$$\n\\begin{cases}\n\\frac{dx_1}{dt} &= f_1(x_1, x_2, \\dots, x_{15}) \\\\\n\\frac{dx_2}{dt} &= f_2(x_1, x_2, \\dots, x_{15}) \\\\\n&\\vdots \\\\\n\\frac{dx_{15}}{dt} &= f_n(x_1, x_2, \\dots, x_{15})\n\\end{cases}\n$$\n\nthe steady-state conditions are obtained by solving system @eq-steady-states:  \n\n$$\n\\begin{cases}\nf_1(x_1^*, x_2^*, \\dots, x_{15}^*)& = 0 \\\\ \nf_2(x_1^*, x_2^*, \\dots, x_{15}^*) &= 0 \\\\\n& \\vdots \\\\\nf_n(x_1^*, x_2^*, \\dots, x_{15}^*) &= 0.\n\\end{cases}\n$$ {#eq-steady-states}\n\n\n:::\n\nTo ensure that the model converged, we assert in @lst-steady-state-convergence that the outcome of the stability analysis is `found`. Other outcomes include `notFound` and `foundNegative` (which is irrealistic in our setting, since concentrations of species can either be positive or null).\n\n\n::: {.cell layout-align=\"center\"}\n\n```{#lst-steady-state-convergence .r .cell-code  lst-cap=\"Check that the model converged with a testthat equal. If not, returns an error.\"}\ntestthat::expect_equal(healthy_model_steady_state$result, \"found\")\n```\n:::\n\n\n## Report steady-state analyses\n\nIn @tbl-steady-state, we report the concentrations of the 15 varying species included in the @lo2016po ODE model describing the dynamic relations among pools of immune cells (macrophages and T-cells) and the secreted cytokines, using the `flextable` package [@flextable].\n\n\n::: {#tbl-steady-state .cell layout-align=\"center\" tbl-cap='Steady-state concentrations of cytokines, macrophages and T cells in healthy individuals, see also **Table 4** reported in [@lo2016po, pp. 10].'}\n\n```{.r .cell-code}\n## Format table for reporting.\nsteady_state_concentrations <- healthy_model_steady_state$species |> \n  select(name, concentration) |> \n  mutate(name = factor(name, \n                          levels = c(\"M1\", \"M2\", \n                                     \"T1\", \"T2\",\n                                     \"T17\", \"Tr\",\n                                     \"Ig\", \"I2\", \"I4\", \"I21\", \"I6\",\n                                     \"Ia\", \"I10\", \"Ib\", \"I12\"),\n                          labels = c(\"M1 macrophage\", \"M2 macrophage\", \n                                     \"Th1 cell\", \"Th2 cell\",\n                                     \"Th17 cell\", \"Treg cell\", \n                                     \"IFN-g\", \"IL-2\", \"IL-4\", \"IL-21\", \"IL-6\", \n                                     \"TNF-a\", \"IL-10\", \"TFG-b\", \"IL-12\"),\n                       ordered = TRUE)) |> \n  arrange(name)\n\n## Format steady-state analysis report for Table 4 ----\nsteady_state_labels <- list(\n  name = \"Species\",\n  concentration = \"Value(g/cm^3)\")\n\nsteady_state_table <- flextable(steady_state_concentrations) |> \n  # format to scientific notation, allowing max 2 significant digits\n  colformat_double(j = \"concentration\", digits = 3) |> \n  set_formatter(concentration = function(x) {\n    formatC(x, format = \"e\", digits = 2)\n  }) |> \n  add_footer_row(values = \"doi:10.1371/journal.pone.0165782.t004\", \n                 colwidths = 2) |> \n  compose(j = \"name\", \n          i = ~ name %in% c(\"IFN-g\", \"TNF-a\", \"TFG-b\"),\n          value = as_paragraph(as_equation(c(\"\\\\text{IFN}_{\\\\gamma}\",\n                                             \"\\\\text{TNF}_{\\\\alpha}\",\n                                             \"\\\\text{TGF}_{\\\\beta}\")))) |> \n  set_header_labels(values = steady_state_labels) |> \n  bold(part = \"header\") |> \n  set_caption(\"Table 4: Steady-state concentrations of cytokines,\n              macrophages and T cells in a healthy individual.\") \n\nsteady_state_table\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-863dfbf0{}.cl-86009076{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-860090bc{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-8610a0f6{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-8610a150{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-86115096{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-861150aa{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-861150b4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-861150be{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-861150bf{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-861150c8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-861150c9{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-863dfbf0'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-86115096\"><p class=\"cl-8610a0f6\"><span class=\"cl-86009076\">Species</span></p></th><th class=\"cl-861150aa\"><p class=\"cl-8610a150\"><span class=\"cl-86009076\">Value(g/cm^3)</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-861150b4\"><p class=\"cl-8610a0f6\"><span class=\"cl-860090bc\">M1 macrophage</span></p></td><td class=\"cl-861150be\"><p class=\"cl-8610a150\"><span class=\"cl-860090bc\">1.17e-02</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-861150b4\"><p class=\"cl-8610a0f6\"><span class=\"cl-860090bc\">M2 macrophage</span></p></td><td class=\"cl-861150be\"><p class=\"cl-8610a150\"><span class=\"cl-860090bc\">8.17e-03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-861150b4\"><p class=\"cl-8610a0f6\"><span class=\"cl-860090bc\">Th1 cell</span></p></td><td class=\"cl-861150be\"><p class=\"cl-8610a150\"><span class=\"cl-860090bc\">1.40e-01</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-861150b4\"><p class=\"cl-8610a0f6\"><span class=\"cl-860090bc\">Th2 cell</span></p></td><td class=\"cl-861150be\"><p class=\"cl-8610a150\"><span class=\"cl-860090bc\">3.99e-03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-861150b4\"><p class=\"cl-8610a0f6\"><span class=\"cl-860090bc\">Th17 cell</span></p></td><td class=\"cl-861150be\"><p class=\"cl-8610a150\"><span class=\"cl-860090bc\">6.18e-03</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-861150b4\"><p class=\"cl-8610a0f6\"><span class=\"cl-860090bc\">Treg cell</span></p></td><td class=\"cl-861150be\"><p class=\"cl-8610a150\"><span class=\"cl-860090bc\">2.98e-04</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-861150b4\"><p class=\"cl-8610a0f6\">NA</p></td><td class=\"cl-861150be\"><p class=\"cl-8610a150\"><span class=\"cl-860090bc\">2.01e-07</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-861150b4\"><p class=\"cl-8610a0f6\"><span class=\"cl-860090bc\">IL-2</span></p></td><td class=\"cl-861150be\"><p class=\"cl-8610a150\"><span class=\"cl-860090bc\">1.07e-08</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-861150b4\"><p class=\"cl-8610a0f6\"><span class=\"cl-860090bc\">IL-4</span></p></td><td class=\"cl-861150be\"><p class=\"cl-8610a150\"><span class=\"cl-860090bc\">3.36e-09</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-861150b4\"><p class=\"cl-8610a0f6\"><span class=\"cl-860090bc\">IL-21</span></p></td><td class=\"cl-861150be\"><p class=\"cl-8610a150\"><span class=\"cl-860090bc\">7.77e-08</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-861150b4\"><p class=\"cl-8610a0f6\"><span class=\"cl-860090bc\">IL-6</span></p></td><td class=\"cl-861150be\"><p class=\"cl-8610a150\"><span class=\"cl-860090bc\">1.46e-06</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-861150b4\"><p class=\"cl-8610a0f6\">NA</p></td><td class=\"cl-861150be\"><p class=\"cl-8610a150\"><span class=\"cl-860090bc\">2.72e-05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-861150b4\"><p class=\"cl-8610a0f6\"><span class=\"cl-860090bc\">IL-10</span></p></td><td class=\"cl-861150be\"><p class=\"cl-8610a150\"><span class=\"cl-860090bc\">3.01e-08</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-861150b4\"><p class=\"cl-8610a0f6\">NA</p></td><td class=\"cl-861150be\"><p class=\"cl-8610a150\"><span class=\"cl-860090bc\">1.64e-13</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-861150bf\"><p class=\"cl-8610a0f6\"><span class=\"cl-860090bc\">IL-12</span></p></td><td class=\"cl-861150c8\"><p class=\"cl-8610a150\"><span class=\"cl-860090bc\">3.64e-07</span></p></td></tr></tbody><tfoot><tr style=\"overflow-wrap:break-word;\"><td  colspan=\"2\"class=\"cl-861150c9\"><p class=\"cl-8610a0f6\"><span class=\"cl-860090bc\">doi:10.1371/journal.pone.0165782.t004</span></p></td></tr></tfoot></table></div>\n```\n\n:::\n:::\n\n",
    "supporting": [
      "steady_state_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/tabwid-1.1.3/tabwid.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/tabwid-1.1.3/tabwid.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bastien CHASSAGNOL">
<meta name="author" content="Lilija Wehling">
<meta name="author" content="Atreyee Banerjee">
<meta name="author" content="Soria Gasparini">
<meta name="author" content="Sanjana Balaji Kuttae">

<title>Patient stratification – ODE Model of Inflammatory Bowel Disease</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../reproducibility/prcc.html" rel="prev">
<link href="../assets/img/IBD-disease.jpeg" rel="icon" type="image/jpeg">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-4a990d8dcb58f517c7c86712b8f2ac7c.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-46f4cc9626f044588a66931b604fc9c8.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-4a990d8dcb58f517c7c86712b8f2ac7c.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-e6a5304361883dadcbb84c7844f59516.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-0a5e1b7ee5cde1aae5572f18c13d6fab.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-e6a5304361883dadcbb84c7844f59516.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/iconify-2.1.0/iconify-icon.min.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<link href="../site_libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="../site_libs/tabwid-1.1.3/tabwid.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Patient stratification – ODE Model of Inflammatory Bowel Disease">
<meta property="og:description" content="This GitHub repository stores the R code and COPASI models for reproducing Lo2016’s model on Inflammatory Bowel Disease.">
<meta property="og:image" content="https://bastienchassagnol.github.io/Lo2016_ODE_IBD/reproducibility/patient_stratification_files/figure-html/fig-treatment-blockade-1.png">
<meta property="og:site_name" content="ODE Model of Inflammatory Bowel Disease">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1344">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../assets/img/IBD-disease.jpeg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ODE Model of Inflammatory Bowel Disease</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../files.html"> 
<span class="menu-text">Files</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../GTBioSS_slides.html"> 
<span class="menu-text">GT BioSS slides</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-curation" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Curation</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-curation">    
        <li>
    <a class="dropdown-item" href="../reproducibility/steady_state.html">
 <span class="dropdown-text">Steady State</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../reproducibility/prcc.html">
 <span class="dropdown-text">PRCC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../reproducibility/patient_stratification.html">
 <span class="dropdown-text">Patient Stratification</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://bastienchassagnol.github.io/bastien.chassagnol.io/"> <i class="bi bi-folder-symlink" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/posts/bastien-chassagnol-677b67140_identifiersorg-activity-7250082014123425793-jItc"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:bastien_chassagnol@laposte.net"> <i class="bi bi-envelope" role="img" aria-label="email">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/bastienchassagnol/COPASI_Team216_Lo2016">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/bastienchassagnol/COPASI_Team216_Lo2016/issues">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../reproducibility/patient_stratification.html">Patient Stratification</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
  <div id="quarto-announcement" data-announcement-id="2449c185770fef7e9639b4d1485f586c" class="alert alert-warning hidden"><i class="bi bi-cone-striped quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p>Website under active development</p>
</div><i class="bi bi-x-lg quarto-announcement-action"></i></div>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Patient stratification</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-heading">Affiliations</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Bastien CHASSAGNOL <a href="mailto:bastien_chassagnol@laposte.net" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Sorbonne University
            </p>
          <p class="affiliation">
              University Laval
            </p>
        </div>
      <div class="quarto-title-meta-contents">
      <p class="author">Lilija Wehling <a href="mailto:Wehling@bmedx.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Virtual Patient Engine BioMed X Institute
            </p>
        </div>
      <div class="quarto-title-meta-contents">
      <p class="author">Atreyee Banerjee <a href="mailto:banerjeea@mpip-mainz.mpg.de" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Mainz Universität
            </p>
        </div>
      <div class="quarto-title-meta-contents">
      <p class="author">Soria Gasparini <a href="mailto:soria.gasparini@stud.uni-heidelberg.de" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Heidelberg University
            </p>
        </div>
      <div class="quarto-title-meta-contents">
      <p class="author">Sanjana Balaji Kuttae <a href="mailto:balaji-kuttae@bmedx.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Virtual Patient Engine BioMed X Institute
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Sunday, the 18th of May, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reproducibility/steady_state.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Steady State</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reproducibility/prcc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PRCC</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reproducibility/patient_stratification.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Patient Stratification</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#parameter-estimation-and-patient-stratification" id="toc-parameter-estimation-and-patient-stratification" class="nav-link active" data-scroll-target="#parameter-estimation-and-patient-stratification"><span class="header-section-number">1</span> Parameter estimation and patient stratification</a>
  <ul>
  <li><a href="#differential-analyses" id="toc-differential-analyses" class="nav-link" data-scroll-target="#differential-analyses"><span class="header-section-number">1.1</span> Differential analyses</a></li>
  <li><a href="#configure-the-experimental-design-and-the-numerical-optimisations" id="toc-configure-the-experimental-design-and-the-numerical-optimisations" class="nav-link" data-scroll-target="#configure-the-experimental-design-and-the-numerical-optimisations"><span class="header-section-number">1.2</span> Configure the experimental design and the numerical optimisations</a></li>
  <li><a href="#sec-parameter-estimation" id="toc-sec-parameter-estimation" class="nav-link" data-scroll-target="#sec-parameter-estimation"><span class="header-section-number">1.3</span> Reporting of parameter estimations</a></li>
  </ul></li>
  <li><a href="#treatment-outcome-and-patient-stratification" id="toc-treatment-outcome-and-patient-stratification" class="nav-link" data-scroll-target="#treatment-outcome-and-patient-stratification"><span class="header-section-number">2</span> Treatment outcome and patient stratification</a>
  <ul>
  <li><a href="#load-free-parameter-variations-in-different-types-of-diseases" id="toc-load-free-parameter-variations-in-different-types-of-diseases" class="nav-link" data-scroll-target="#load-free-parameter-variations-in-different-types-of-diseases"><span class="header-section-number">2.1</span> Load Free Parameter variations in different types of diseases</a></li>
  <li><a href="#model-the-effect-of-tnf-alpha-blockade" id="toc-model-the-effect-of-tnf-alpha-blockade" class="nav-link" data-scroll-target="#model-the-effect-of-tnf-alpha-blockade"><span class="header-section-number">2.2</span> Model the effect of TNF-alpha blockade</a></li>
  <li><a href="#simulation-visualisations-of-the-fold-changes-of-the-cytokine-and-t-cell-concentrations" id="toc-simulation-visualisations-of-the-fold-changes-of-the-cytokine-and-t-cell-concentrations" class="nav-link" data-scroll-target="#simulation-visualisations-of-the-fold-changes-of-the-cytokine-and-t-cell-concentrations"><span class="header-section-number">2.3</span> Simulation visualisations of the fold changes of the cytokine and T cell concentrations</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/bastienchassagnol//COPASI_Team216_Lo2016/edit/master/reproducibility/patient_stratification.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/bastienchassagnol//COPASI_Team216_Lo2016/blob/master/reproducibility/patient_stratification.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/bastienchassagnol//COPASI_Team216_Lo2016/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">






<p>The list of packages required for reproducing the analyses on this script are listed in <a href="#lst-setup-patient-stratification" class="quarto-xref">Listing&nbsp;1</a>. Besides, the downloadable R script file <a href="../../scripts/utils.R"><code>utils</code></a> stores two helper functions:</p>
<ul>
<li><code>get_legend_temp</code> is a temporary fix to retrieve the legend of any <code>ggplot2</code> or <code>grob</code> object (used for further customisation of a panel of subplots). For further details on this custom fix, report to <a href="https://github.com/wilkelab/cowplot/issues/202">Open <code>Cowplot</code> Issue for shared legend feature</a>.</li>
<li><code>colourer</code> is a custom styling function displaying all positive values as <em>red</em>, and negative ones as <em>blue</em> (used with <code>flextable</code>).</li>
</ul>
<div class="cell" data-layout-align="center">
<div id="lst-setup-patient-stratification" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-setup-patient-stratification-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;1: Packages required for analysing biological differences between patient conditions.
</figcaption>
<div aria-describedby="lst-setup-patient-stratification-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(CoRC)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Data wrangling</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Table visualisation</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot visualisation</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(latex2exp)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../../scripts/utils.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</figure>
</div>
</div>
<section id="parameter-estimation-and-patient-stratification" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="parameter-estimation-and-patient-stratification"><span class="header-section-number">1</span> Parameter estimation and patient stratification</h2>
<p>To run an experimental design, we need:</p>
<ul>
<li>the model itself, and notably the steady-state concentrations, and the parameter constants.</li>
<li>Experimental data, where for a given condition (here, patient cluster), the columns correspond to the species concentrations, and the rows to the indiviudal observations. Real-life measures of fold changes have been reported in <a href="#tbl-experiment-data" class="quarto-xref">Table&nbsp;1</a>.</li>
<li>The R code used for loading the healthy model and the clinical datasets, is reported in <a href="#lst-load-experiences" class="quarto-xref">Listing&nbsp;2</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</li>
</ul>
<section id="differential-analyses" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="differential-analyses"><span class="header-section-number">1.1</span> Differential analyses</h3>
<p><strong>Note that <span class="citation" data-cites="lo2016po">Lo et al. (<a href="#ref-lo2016po" role="doc-biblioref">2016</a>)</span> did not provide unfortunately the individual cytokine concentrations, preventing from reproducing the differential analyses and quite hampering the validity of <a href="https://copasi.org/Support/User_Manual/Tasks/Parameter_Estimation/">Parameter estimation</a> Task.</strong></p>
<div class="cell" data-layout-align="center">
<div id="lst-load-experiences" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-load-experiences-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;2: Code snippet not run, used for illustration example.
</figcaption>
<div aria-describedby="lst-load-experiences-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Healthy ODE model along with the parameter constants</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>healthy_model <span class="ot">&lt;-</span> <span class="fu">loadModel</span>(<span class="st">"../../models/team_2016_final_model_lo2016_2025_05_13.cps"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>healthy_steaty_state <span class="ot">&lt;-</span> <span class="fu">runSteadyState</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">calculate_jacobian =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> healthy_model</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>)<span class="sc">$</span>species <span class="sc">|&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name, <span class="at">concentrationH =</span> concentration)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Load experimental datasets providing real-life concentrations of cytokines</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>cluster_type <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Type 1"</span>, <span class="st">"Type 2"</span>, <span class="st">"Type 3"</span>, <span class="st">"Type 4"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>data_experiment <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"../../data/IBD DGEA.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">!</span>cluster, <span class="at">names_to =</span> <span class="st">"name"</span>, <span class="at">values_to =</span> <span class="st">"concentration"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(healthy_steaty_state, <span class="at">by =</span> <span class="st">"name"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">concentration =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(concentrationH),</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                            concentrationH <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> concentration <span class="sc">/</span> <span class="dv">100</span>), concentration</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">concentrationH =</span> <span class="cn">NULL</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> name, <span class="at">values_from =</span> concentration) <span class="sc">|&gt;</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(<span class="at">f =</span> cluster_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</figure>
</div>
</div>
<div class="cell" data-layout-align="center">
<div id="tbl-experiment-data" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-experiment-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="tabwid"><style>.cl-9488ae0e{}.cl-94744f18{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-94744f36{font-family:'Arial';font-size:6.6pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;position: relative;bottom:3.3pt;}.cl-947cabe0{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-947cabf4{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-947d2e26{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-947d2e44{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-947d2e45{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-947d2e4e{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-947d2e62{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-947d2e63{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-947d2e6c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-9488ae0e"><thead><tr style="overflow-wrap:break-word;"><th class="cl-947d2e26"><p class="cl-947cabe0"><span class="cl-94744f18">Types of disease</span></p></th><th class="cl-947d2e26"><p class="cl-947cabe0"><span class="cl-94744f18">Species</span></p></th><th class="cl-947d2e26"><p class="cl-947cabe0"><span class="cl-94744f18">Species' concentration at steady-state</span></p></th><th class="cl-947d2e26"><p class="cl-947cabe0"><span class="cl-94744f18">Concentrations in IBD clusters</span></p></th><th class="cl-947d2e44"><p class="cl-947cabf4"><span class="cl-94744f18">fold change</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 1</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">I6</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.46e-06</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.02e-07</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">-93.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 1</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">I10</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">3.01e-08</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.48e-08</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">-51.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 1</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">Ia</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">2.72e-05</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.88e-05</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">-31.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 1</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">Ib</span><span class="cl-94744f36">*</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.64e-13</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">7.23e-14</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">-56.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 1</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">Ig</span><span class="cl-94744f36">*</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">2.01e-07</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">2.01e-09</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">-99.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 2</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">I6</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.46e-06</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">3.78e-07</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">-74.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 2</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">I10</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">3.01e-08</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">2.56e-08</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">-15.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 2</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">Ia</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">2.72e-05</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.88e-05</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">-31.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 2</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">Ib</span><span class="cl-94744f36">*</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.64e-13</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.54e-13</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">-6.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 2</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">Ig</span><span class="cl-94744f36">*</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">2.01e-07</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.61e-08</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">-92.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 3</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">I6</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.46e-06</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.96e-06</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">35.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 3</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">I10</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">3.01e-08</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">4.34e-08</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">44.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 3</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">Ia</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">2.72e-05</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">4.00e-05</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">47.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 3</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">Ib</span><span class="cl-94744f36">*</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.64e-13</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.95e-13</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">19.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 3</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">Ig</span><span class="cl-94744f36">*</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">2.01e-07</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.17e-06</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">481.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 4</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">I6</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.46e-06</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">2.47e-07</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">-83.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 4</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">I10</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">3.01e-08</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.99e-08</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">-34.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 4</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">Ia</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">2.72e-05</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.49e-05</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">-45.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">type 4</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">Ib</span><span class="cl-94744f36">*</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.64e-13</span></p></td><td class="cl-947d2e45"><p class="cl-947cabe0"><span class="cl-94744f18">1.31e-13</span></p></td><td class="cl-947d2e4e"><p class="cl-947cabf4"><span class="cl-94744f18">-20.0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-947d2e62"><p class="cl-947cabe0"><span class="cl-94744f18">type 4</span></p></td><td class="cl-947d2e62"><p class="cl-947cabe0"><span class="cl-94744f18">Ig</span><span class="cl-94744f36">*</span></p></td><td class="cl-947d2e62"><p class="cl-947cabe0"><span class="cl-94744f18">2.01e-07</span></p></td><td class="cl-947d2e62"><p class="cl-947cabe0"><span class="cl-94744f18">1.00e-08</span></p></td><td class="cl-947d2e63"><p class="cl-947cabf4"><span class="cl-94744f18">-95.0%</span></p></td></tr></tbody><tfoot><tr style="overflow-wrap:break-word;"><td colspan="5" class="cl-947d2e6c"><p class="cl-947cabe0"><span class="cl-94744f36">*</span><span class="cl-94744f18">These quantities have not been measured, but rather estimated from the model.</span></p></td></tr></tfoot></table></div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-experiment-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Fold changes of <em>cytokine</em> concentrations obtained from clinical data, reported in <em>Table 7</em>, <span class="citation" data-cites="lo2016po">(<a href="#ref-lo2016po" role="doc-biblioref">Lo et al. 2016, 13</a>)</span>. <code>Species</code> is the cytokines’ name, while cluster indicator is returned by <code>Types of disease</code>. Note that we have not reported species concentrations of <span class="math inline">\(T-Bet\)</span>, <span class="math inline">\(Gata3\)</span>, <span class="math inline">\(ROR \gamma t\)</span>, and <span class="math inline">\(Foxp3\)</span> as not measured in the ODE model.
</figcaption>
</figure>
</div>
</div>
</section>
<section id="configure-the-experimental-design-and-the-numerical-optimisations" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="configure-the-experimental-design-and-the-numerical-optimisations"><span class="header-section-number">1.2</span> Configure the experimental design and the numerical optimisations</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define larger lower and upper bounds</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>free_parameters_key <span class="ot">&lt;-</span> <span class="fu">getParameters</span>(<span class="fu">c</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Prod of Ig from T1).k1"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Prod of Ia from T1).k1"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Prod of Ib from Tr).k1"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Prod of I10 from Tr).v10r"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Induction of T1 from M).s12"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Induction of T2).s4"</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Induction of T17).s21"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Induction of T17).s6"</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Induction of Tr).sb"</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Induction of Tr).s10"</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>), <span class="at">model =</span> healthy_model)<span class="sc">$</span>key</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>fit_parameters <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(free_parameters_key, <span class="cf">function</span>(param) {</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  val <span class="ot">&lt;-</span> <span class="fu">getParameters</span>(param)<span class="sc">$</span>value</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">defineParameterEstimationParameter</span>(</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">ref =</span> <span class="fu">parameter</span>(param, <span class="st">"Value"</span>),</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_value =</span> val,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower_bound =</span> <span class="fl">1e-15</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper_bound =</span> <span class="fl">1e4</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>mapping_present <span class="ot">&lt;-</span> <span class="fu">getSpeciesReferences</span>(</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">key =</span> <span class="fu">c</span>(<span class="st">"I6"</span>, <span class="st">"I10"</span>, <span class="st">"Ia"</span>, <span class="st">"Ib"</span>, <span class="st">"Ig"</span>),</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> healthy_model</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(concentration)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>fit_experiments <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(data_experiment, <span class="sc">~</span> <span class="fu">defineExperiments</span>(</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">experiment_type =</span> <span class="st">"steady_state"</span>,</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> .x,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">types =</span> <span class="fu">c</span>(</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ignore"</span>, <span class="st">"dependent"</span>, <span class="st">"dependent"</span>, <span class="st">"dependent"</span>,</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ignore"</span>, <span class="st">"ignore"</span>, <span class="st">"ignore"</span>, <span class="st">"ignore"</span>, <span class="st">"ignore"</span>, <span class="st">"ignore"</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">mappings =</span> <span class="fu">c</span>(<span class="cn">NA</span>, mapping_present,  <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">4</span>)),</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_method =</span> <span class="st">"mean_square"</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="sourceCode" id="annotated-cell-4"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1">1</button><span id="annotated-cell-4-1" class="code-annotation-target"><a href="#annotated-cell-4-1" aria-hidden="true" tabindex="-1"></a>free_parameters_key <span class="ot">&lt;-</span> <span class="fu">getParameters</span>(<span class="fu">c</span>(<span class="st">"(Prod of Ig from T1).k1"</span>,</span>
<span id="annotated-cell-4-2"><a href="#annotated-cell-4-2" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Prod of Ia from T1).k1"</span>,</span>
<span id="annotated-cell-4-3"><a href="#annotated-cell-4-3" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Prod of Ib from Tr).k1"</span>,</span>
<span id="annotated-cell-4-4"><a href="#annotated-cell-4-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Prod of I10 from Tr).v10r"</span>,</span>
<span id="annotated-cell-4-5"><a href="#annotated-cell-4-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Induction of T1 from M).s12"</span>,</span>
<span id="annotated-cell-4-6"><a href="#annotated-cell-4-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Induction of T2).s4"</span>,</span>
<span id="annotated-cell-4-7"><a href="#annotated-cell-4-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Induction of T17).s21"</span>,</span>
<span id="annotated-cell-4-8"><a href="#annotated-cell-4-8" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Induction of T17).s6"</span>,</span>
<span id="annotated-cell-4-9"><a href="#annotated-cell-4-9" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Induction of Tr).sb"</span>,</span>
<span id="annotated-cell-4-10"><a href="#annotated-cell-4-10" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Induction of Tr).s10"</span>), <span class="at">model =</span> healthy_model)<span class="sc">$</span>key</span>
<span id="annotated-cell-4-11"><a href="#annotated-cell-4-11" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="2">2</button><span id="annotated-cell-4-12" class="code-annotation-target"><a href="#annotated-cell-4-12" aria-hidden="true" tabindex="-1"></a>fit_parameters <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(free_parameters_key, <span class="cf">function</span>(param) {</span>
<span id="annotated-cell-4-13"><a href="#annotated-cell-4-13" aria-hidden="true" tabindex="-1"></a>  val <span class="ot">&lt;-</span> <span class="fu">getParameters</span>(param)<span class="sc">$</span>value</span>
<span id="annotated-cell-4-14"><a href="#annotated-cell-4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">defineParameterEstimationParameter</span>(</span>
<span id="annotated-cell-4-15"><a href="#annotated-cell-4-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ref =</span> <span class="fu">parameter</span>(param, <span class="st">"Value"</span>),</span>
<span id="annotated-cell-4-16"><a href="#annotated-cell-4-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_value =</span> val,</span>
<span id="annotated-cell-4-17"><a href="#annotated-cell-4-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower_bound =</span> <span class="fl">1e-15</span>,</span>
<span id="annotated-cell-4-18"><a href="#annotated-cell-4-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper_bound =</span> <span class="fl">1e4</span>)</span>
<span id="annotated-cell-4-19"><a href="#annotated-cell-4-19" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="annotated-cell-4-20"><a href="#annotated-cell-4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-4-21"><a href="#annotated-cell-4-21" aria-hidden="true" tabindex="-1"></a>mapping_present <span class="ot">&lt;-</span> <span class="fu">getSpeciesReferences</span>(</span>
<span id="annotated-cell-4-22"><a href="#annotated-cell-4-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">key =</span> <span class="fu">c</span>(<span class="st">"I6"</span>, <span class="st">"I10"</span>, <span class="st">"Ia"</span>, <span class="st">"Ib"</span>, <span class="st">"Ig"</span>),</span>
<span id="annotated-cell-4-23"><a href="#annotated-cell-4-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> healthy_model</span>
<span id="annotated-cell-4-24"><a href="#annotated-cell-4-24" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(concentration)</span>
<span id="annotated-cell-4-25"><a href="#annotated-cell-4-25" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="3">3</button><span id="annotated-cell-4-26" class="code-annotation-target"><a href="#annotated-cell-4-26" aria-hidden="true" tabindex="-1"></a>fit_experiments <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(data_experiment, <span class="sc">~</span> <span class="fu">defineExperiments</span>(</span>
<span id="annotated-cell-4-27"><a href="#annotated-cell-4-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">experiment_type =</span> <span class="st">"steady_state"</span>,</span>
<span id="annotated-cell-4-28"><a href="#annotated-cell-4-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> .x,</span>
<span id="annotated-cell-4-29"><a href="#annotated-cell-4-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">types =</span> <span class="fu">c</span>(</span>
<span id="annotated-cell-4-30"><a href="#annotated-cell-4-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ignore"</span>, <span class="st">"dependent"</span>, <span class="st">"dependent"</span>, <span class="st">"dependent"</span>,</span>
<span id="annotated-cell-4-31"><a href="#annotated-cell-4-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ignore"</span>, <span class="st">"ignore"</span>, <span class="st">"ignore"</span>, <span class="st">"ignore"</span>, <span class="st">"ignore"</span>, <span class="st">"ignore"</span>),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="4">4</button><span id="annotated-cell-4-32" class="code-annotation-target"><a href="#annotated-cell-4-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">mappings =</span> <span class="fu">c</span>(<span class="cn">NA</span>, mapping_present,  <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">4</span>)),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="5">5</button><span id="annotated-cell-4-33" class="code-annotation-target"><a href="#annotated-cell-4-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_method =</span> <span class="st">"mean_square"</span></span>
<span id="annotated-cell-4-34"><a href="#annotated-cell-4-34" aria-hidden="true" tabindex="-1"></a>))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="1,2,3,4,5,6,7,8,9,10" data-code-annotation="1">To adjust the variations of steady-state concentrations observed in the identified four subgroups of patients suffering from Inflammatory Bowel Disease, <span class="citation" data-cites="lo2016po">Lo et al. (<a href="#ref-lo2016po" role="doc-biblioref">2016</a>)</span> chose to play with 10 biological constants (10 degrees of freedom). Note that for the system of equations to be <strong>determined</strong> (at the very least), the number of free parameters to estimate must be equal or inferior to the number of equations (here, one by species included in the ODE model, aka 15).</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="12,13,14,15,16,17,18,19" data-code-annotation="2">We initialise the iterative search by initialising the 10 free parameters with the biological constant vitals observed in healthy inviduals. Besides, we can enforce bounds (either for each of the parameters, or shared by all of them), coercing the optimisation algorithm not to go beyond.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="26,27,28,29,30,31,34" data-code-annotation="3">For each of the patient subgroups, we need to provide the type of experiment (either <code>steady-state</code>, or <code>time_course</code> when several time points have been considered in the design), the measured concentrations diverging from the average concentrations in healthy patients with <code>data</code>, define each of the measured variables (constant with <code>independent</code>, <code>dependent</code> if used for tailoring the parameter estimates, or <code>ignore</code> if not quantified in the ODE model). We had only the averaged expression per patient subgroup To better capture within-patient variability, it would have been valuable to provide the individual cytokine profiles, and perform a <a href="https://en.wikipedia.org/wiki/General_linear_model"><strong>multiple least-squares regression, aka MMR</strong></a> task.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="32" data-code-annotation="4"><code>mappings</code> guarantees the proper pairing between COPASI variables and string values of column names<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="33" data-code-annotation="5">Finally, the [<code>weight_method</code>] coupled with <code>weights</code> describe for each variable the assumed mean-variation trend. Report to COPASI Manual, section <a href="https://copasi.org/Support/User_Manual/Tasks/Parameter_Estimation/Experimental_Data/"><em>Experimental Data</em></a>, for further details.</span>
</dd>
</dl>
<p>Finally, once the experimental design and optimisation criterias have been configured independently for each free parameter and patient subgroup, we have to run the parameter estimation itself:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>absolute_parameter_per_cluster <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(fit_experiments, <span class="cf">function</span>(cluster) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># CoRC update imposes to restart from a clean model for parameter estimation</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  CoRC<span class="sc">::</span><span class="fu">clearParameterEstimationParameters</span>(<span class="at">model =</span> healthy_model)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  CoRC<span class="sc">::</span><span class="fu">clearExperiments</span>(<span class="at">model =</span> healthy_model)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">runParameterEstimation</span>(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">parameters =</span> fit_parameters,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">experiments =</span> cluster,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="fu">list</span>(</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"LevenbergMarquardt"</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">log_verbosity =</span> <span class="dv">0</span>, </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">iteration_limit =</span> <span class="dv">200</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-5</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">update_model =</span> <span class="cn">FALSE</span>, </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">randomize_start_values =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">create_parameter_sets =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">calculate_statistics =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> healthy_model</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">$</span>parameters)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Make results directly comparable with Table 8 by switchign from absolute to relative ratios</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>relative_parameter_per_cluster <span class="ot">&lt;-</span> absolute_parameter_per_cluster <span class="sc">|&gt;</span> </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">list_rbind</span>(<span class="at">names_to =</span> <span class="st">"cluster"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(cluster, parameter, start_value, value) <span class="sc">|&gt;</span> </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">relative_concentration =</span> <span class="dv">100</span><span class="sc">*</span>(value <span class="sc">-</span> start_value)<span class="sc">/</span>start_value,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">start_value =</span> <span class="cn">NULL</span>, <span class="at">value =</span> <span class="cn">NULL</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> parameter, <span class="at">values_from =</span> relative_concentration) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="sourceCode" id="annotated-cell-6"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="1">1</button><span id="annotated-cell-6-1" class="code-annotation-target"><a href="#annotated-cell-6-1" aria-hidden="true" tabindex="-1"></a>absolute_parameter_per_cluster <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(fit_experiments, <span class="cf">function</span>(cluster) {</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="2">2</button><span id="annotated-cell-6-2" class="code-annotation-target"><a href="#annotated-cell-6-2" aria-hidden="true" tabindex="-1"></a>  CoRC<span class="sc">::</span><span class="fu">clearParameterEstimationParameters</span>(<span class="at">model =</span> healthy_model)</span>
<span id="annotated-cell-6-3"><a href="#annotated-cell-6-3" aria-hidden="true" tabindex="-1"></a>  CoRC<span class="sc">::</span><span class="fu">clearExperiments</span>(<span class="at">model =</span> healthy_model)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="3">3</button><span id="annotated-cell-6-4" class="code-annotation-target"><a href="#annotated-cell-6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">runParameterEstimation</span>(</span>
<span id="annotated-cell-6-5"><a href="#annotated-cell-6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">parameters =</span> fit_parameters,</span>
<span id="annotated-cell-6-6"><a href="#annotated-cell-6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">experiments =</span> cluster,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="4">4</button><span id="annotated-cell-6-7" class="code-annotation-target"><a href="#annotated-cell-6-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"LevenbergMarquardt"</span>,</span>
<span id="annotated-cell-6-8"><a href="#annotated-cell-6-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">iteration_limit =</span> <span class="dv">500</span>,</span>
<span id="annotated-cell-6-9"><a href="#annotated-cell-6-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tolerance =</span> <span class="fl">1e-6</span>),</span>
<span id="annotated-cell-6-10"><a href="#annotated-cell-6-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">update_model =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-6-11"><a href="#annotated-cell-6-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">randomize_start_values =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-6-12"><a href="#annotated-cell-6-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">create_parameter_sets =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-6-13"><a href="#annotated-cell-6-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">calculate_statistics =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-6-14"><a href="#annotated-cell-6-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> healthy_model</span>
<span id="annotated-cell-6-15"><a href="#annotated-cell-6-15" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">$</span>parameters)</span>
<span id="annotated-cell-6-16"><a href="#annotated-cell-6-16" aria-hidden="true" tabindex="-1"></a>})</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-6" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="1" data-code-annotation="1">We learn a configuration of 10 free parameters independently for each patient subgroup.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="2,3" data-code-annotation="2">Recall that in COPASI, models are modified by reference rather than by copy. These auxiliary functions, <code>clearParameterEstimationParameters</code> and <code>clearExperiments</code> guarantee a fresh start for parameter estimation for each scenario.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="4,5,6,10,11,12,13,14" data-code-annotation="3">The core function, <code>runParameterEstimation</code>, of the pipeline for estimating varying constants across distinct biological conditions.</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="7,8,9" data-code-annotation="4">There are plenty of optimisation approaches to reduce the discrepancy between the healthy-state concentrations of immune cells, and the ones observed across each patient cluster, listed in <a href="https://copasi.org/Support/User_Manual/Methods/Optimization_Methods/">Optimization Methods</a>. <strong>Unfortunately, the precise optimisation method used in <span class="citation" data-cites="lo2016po">Lo et al. (<a href="#ref-lo2016po" role="doc-biblioref">2016</a>)</span> has not been detailed, nor the hyperparameters used.</strong> We arbitrarily chose the <a href="https://copasi.org/Support/User_Manual/Methods/Optimization_Methods/Levenberg_-_Marquardt/">Levenberg - Marquardt</a> approach that is a good compromise between first-order, steepest descent approaches, and second-order, Newton-Raphson like approaches (see <a href="#tip-optimisation" class="quarto-xref">Tip&nbsp;1</a> for details). The <code>iteration_limit</code> determines the maximum number of iterations the algorithm shall perform, while <code>tolerance</code> is the numerical precision to reach between two consecutive iterations.</span>
</dd>
</dl>
<div id="tip-optimisation" class="callout callout-style-default callout-tip callout-titled" title="Optimisation Descent Methods">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip&nbsp;1: Optimisation Descent Methods
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Consider a multivariate function <span class="math inline">\(f(\mathbf{x})\)</span> that we want to <strong>maximize</strong> with respect to <span class="math inline">\(\mathbf{x}\)</span> (for instance, we may want to minimise the mean-squared error between estimated steady-state concentrations and ones measured in each patient subgroup). Standard unconstrained optimization approaches include <em>Gradient Descent</em> (see <a href="#eq-GD" class="quarto-xref">Equation&nbsp;1</a>), <em>Newton-Raphson</em> (see <a href="#eq-NR" class="quarto-xref">Equation&nbsp;2</a>) and <em>Levenbergh-Marquart</em> (see <a href="#eq-LM" class="quarto-xref">Equation&nbsp;3</a>):</p>
<hr>
<p>The <strong>Steepest Descent Approach</strong>, where the method updates <span class="math inline">\(\mathbf{x}\)</span> in the direction of the gradient (steepest slope):</p>
<p><span id="eq-GD"><span class="math display">\[
\mathbf{x}_{k+1} = \mathbf{x}_k + \alpha_k \nabla f(\mathbf{x}_k)
\tag{1}\]</span></span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\nabla f(\mathbf{x}_k)\)</span> is the gradient of <span class="math inline">\(f\)</span> at <span class="math inline">\(\mathbf{x}_k\)</span>,<br>
</li>
<li><span class="math inline">\(\alpha_k\)</span> is the <strong>step size (learning rate)</strong>, sometimes fixed. Playing on this parameter may prevent revolving round the optimum.<br>
</li>
<li><strong>The steepest descent method only converges linearly, but is guaranteed to converge.</strong></li>
</ul>
<hr>
<p>The <strong>Newton-Raphson Approach</strong> is a second-order method, requiring the computation of the <em>Hessian matrix</em>:</p>
<p><span id="eq-NR"><span class="math display">\[
\mathbf{x}_{k+1} = \mathbf{x}_k +  \mathbf{H}^{-1}(\mathbf{x}_k) \nabla f(\mathbf{x}_k)
\tag{2}\]</span></span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\mathbf{H}(\mathbf{x}_k) = \nabla^2 f(\mathbf{x}_k)\)</span> is the Hessian matrix,<br>
</li>
<li><span class="math inline">\(\nabla f(\mathbf{x}_k)\)</span> is the gradient.</li>
</ul>
<p><strong>On the other hand, the Newton method converges quadratically towards the minimum in its vicinity. However, it’s really sensible to the initialisation, and may not converge at all if it is far away from it</strong>.</p>
<hr>
<p>The <strong>Levenberg-Marquardt Descent Approach</strong> blends Newton’s method with a trust-region adjustment, controlling step size:</p>
<p><span id="eq-LM"><span class="math display">\[
\mathbf{x}_{k+1} = \mathbf{x}_k + \left( \mathbf{H}(\mathbf{x}_k) + \lambda \mathbf{I} \right)^{-1} \nabla f(\mathbf{x}_k)
\tag{3}\]</span></span></p>
<p>where <span class="math inline">\(\lambda\)</span> controls the trade-off between gradient descent, when <span class="math inline">\(\lambda \to \infty\)</span>, and Newton’s method <span class="math inline">\(\lambda \to 0\)</span>.</p>
</div>
</div>
</div>
</section>
<section id="sec-parameter-estimation" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="sec-parameter-estimation"><span class="header-section-number">1.3</span> Reporting of parameter estimations</h3>
<p>Our estimations are compared with <em>Table 8</em>, <span class="citation" data-cites="lo2016po">(<a href="#ref-lo2016po" role="doc-biblioref">Lo et al. 2016, 13</a>)</span> variations in <a href="#tbl-parameter-estimation" class="quarto-xref">Table&nbsp;2</a>.</p>
<p><strong>Of note, all tables in the original paper were provided as screenshots and images, rather than CSV files, preventing straightforward reporducibility of the results</strong>.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># flextable formatting and variables</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>variable_labels <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster =</span> <span class="st">"Type of diseases"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Prod of Ig from T1).k1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"coefficient of IFN-gamma by Th1"</span>, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Prod of Ia from T1).k1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"coefficient of TNF-alpha by Th1"</span>, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Prod of Ib from Tr).k1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"coefficient of TGF-beta by Treg"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Prod of I10 from Tr).v10r</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"coefficient of IL-10 by Treg"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Induction of T1 from M).s12</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"activation of Th1 cells"</span>, </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Induction of T2).s4</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"activation of Th2 cells"</span>, </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Induction of T17).s21</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"activation of Th17 cells"</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Induction of T17).s6</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"activation of Th17 cells"</span>, </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Induction of Tr).sb</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"activation of Treg cells"</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Induction of Tr).s10</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"activation of Treg cells"</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>header_row <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">text{Type of diseases}"</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">nu_{</span><span class="sc">\\</span><span class="st">gamma_1}"</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">nu_{</span><span class="sc">\\</span><span class="st">alpha_1}"</span>, </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">nu_{</span><span class="sc">\\</span><span class="st">beta_{</span><span class="sc">\\</span><span class="st">rho}}"</span>,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">nu_{10_{</span><span class="sc">\\</span><span class="st">rho}}"</span>,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">sigma_{12}"</span>,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">sigma_{4}"</span>,</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">sigma_{21}"</span>,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">sigma_{6}"</span>,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">sigma_{</span><span class="sc">\\</span><span class="st">beta}"</span>,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">sigma_{10}"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_equation</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_paragraph</span>()</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co"># flextable generation</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>relative_parameter_variations_flextable <span class="ot">&lt;-</span> <span class="fu">flextable</span>(relative_parameter_per_cluster) <span class="sc">|&gt;</span> </span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add gradient colouring based on values</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bg</span>(</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">j =</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(variable_labels), <span class="st">"cluster"</span>), </span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg =</span> colourer) <span class="sc">|&gt;</span> </span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Format numbers (optional for consistent display)</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colformat_double</span>(<span class="at">j =</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(variable_labels), <span class="st">"cluster"</span>),</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>                   <span class="at">suffix =</span> <span class="st">"%"</span>,</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>                   <span class="at">big.mark =</span> <span class="st">","</span>, </span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>                   <span class="at">digits =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">append_chunks</span>(<span class="at">j =</span> <span class="st">"cluster"</span>,</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>                <span class="co"># what to append</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>                <span class="fu">as_equation</span>(<span class="fu">c</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">text{Th1}</span><span class="sc">\\</span><span class="st">uparrow </span><span class="sc">\\</span><span class="st">text{Th2}</span><span class="sc">\\</span><span class="st">downarrow"</span>,</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"</span><span class="sc">\\</span><span class="st">text{Th1}</span><span class="sc">\\</span><span class="st">downarrow </span><span class="sc">\\</span><span class="st">text{Th2}</span><span class="sc">\\</span><span class="st">uparrow"</span>, </span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"</span><span class="sc">\\</span><span class="st">text{Th1}</span><span class="sc">\\</span><span class="st">uparrow </span><span class="sc">\\</span><span class="st">text{Th2}</span><span class="sc">\\</span><span class="st">uparrow"</span>,</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"</span><span class="sc">\\</span><span class="st">text{Th1}</span><span class="sc">\\</span><span class="st">downarrow </span><span class="sc">\\</span><span class="st">text{Th2}</span><span class="sc">\\</span><span class="st">downarrow"</span>))</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename columns using LaTeX-like notation</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_header_labels</span>(<span class="at">values =</span> variable_labels</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_row</span>(<span class="at">values =</span> header_row,</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>                 <span class="at">colwidths =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">11</span>), <span class="at">top =</span> <span class="cn">FALSE</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">align</span>(<span class="at">align =</span> <span class="st">"center"</span>, <span class="at">part =</span> <span class="st">"all"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_caption</span>(<span class="st">"Table 8: Parameter variations in different types of diseases. </span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a><span class="st">              In blue, disease subtype induces shrinkage of the coefficients, </span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a><span class="st">              while red values correspond to increased parameter uptakes. "</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge_at</span>(<span class="at">part =</span> <span class="st">"head"</span>, <span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">j=</span> <span class="dv">1</span>)</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>relative_parameter_variations_flextable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-parameter-estimation" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-parameter-estimation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="tabwid"><style>.cl-e017a01e{}.cl-e004b242{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e00c9fc0{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e00cf9e8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cf9fc{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cf9fd{width:0.75in;background-color:rgba(255, 255, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa06{width:0.75in;background-color:rgba(252, 249, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa10{width:0.75in;background-color:rgba(170, 129, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa11{width:0.75in;background-color:rgba(255, 157, 128, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa1a{width:0.75in;background-color:rgba(252, 250, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa24{width:0.75in;background-color:rgba(255, 125, 92, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa25{width:0.75in;background-color:rgba(0, 0, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa2e{width:0.75in;background-color:rgba(255, 113, 79, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa38{width:0.75in;background-color:rgba(220, 196, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa42{width:0.75in;background-color:rgba(251, 249, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa43{width:0.75in;background-color:rgba(193, 158, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa4c{width:0.75in;background-color:rgba(255, 200, 181, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa56{width:0.75in;background-color:rgba(255, 121, 88, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa57{width:0.75in;background-color:rgba(255, 115, 82, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa60{width:0.75in;background-color:rgba(255, 0, 0, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa6a{width:0.75in;background-color:rgba(92, 52, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa6b{width:0.75in;background-color:rgba(80, 43, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa74{width:0.75in;background-color:rgba(25, 8, 255, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa75{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa7e{width:0.75in;background-color:rgba(255, 225, 214, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa7f{width:0.75in;background-color:rgba(250, 247, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa88{width:0.75in;background-color:rgba(84, 46, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa92{width:0.75in;background-color:rgba(255, 0, 0, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa9c{width:0.75in;background-color:rgba(251, 248, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e00cfa9d{width:0.75in;background-color:rgba(0, 0, 255, 1.00);vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-e017a01e"><thead><tr style="overflow-wrap:break-word;"><th rowspan="2" class="cl-e00cf9e8"><p class="cl-e00c9fc0"><span class="cl-e004b242">Type of diseases</span></p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0"><span class="cl-e004b242">coefficient of IFN-gamma by Th1</span></p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0"><span class="cl-e004b242">coefficient of TNF-alpha by Th1</span></p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0"><span class="cl-e004b242">coefficient of TGF-beta by Treg</span></p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0"><span class="cl-e004b242">coefficient of IL-10 by Treg</span></p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0"><span class="cl-e004b242">activation of Th1 cells</span></p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0"><span class="cl-e004b242">activation of Th2 cells</span></p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0"><span class="cl-e004b242">activation of Th17 cells</span></p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0"><span class="cl-e004b242">activation of Th17 cells</span></p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0"><span class="cl-e004b242">activation of Treg cells</span></p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0"><span class="cl-e004b242">activation of Treg cells</span></p></th></tr><tr style="overflow-wrap:break-word;"><th class="cl-e00cf9e8"><p class="cl-e00c9fc0">NA</p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0">NA</p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0">NA</p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0">NA</p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0">NA</p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0">NA</p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0">NA</p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0">NA</p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0">NA</p></th><th class="cl-e00cf9e8"><p class="cl-e00c9fc0">NA</p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-e00cf9fc"><p class="cl-e00c9fc0"><span class="cl-e004b242">Type 1</span>NA</p></td><td class="cl-e00cf9fd"><p class="cl-e00c9fc0"><span class="cl-e004b242">64.7%</span></p></td><td class="cl-e00cfa06"><p class="cl-e00c9fc0"><span class="cl-e004b242">-2.6%</span></p></td><td class="cl-e00cfa10"><p class="cl-e00c9fc0"><span class="cl-e004b242">-54.6%</span></p></td><td class="cl-e00cfa11"><p class="cl-e00c9fc0"><span class="cl-e004b242">141.7%</span></p></td><td class="cl-e00cfa1a"><p class="cl-e00c9fc0"><span class="cl-e004b242">-2.0%</span></p></td><td class="cl-e00cfa24"><p class="cl-e00c9fc0"><span class="cl-e004b242">15.8%</span></p></td><td class="cl-e00cfa25"><p class="cl-e00c9fc0"><span class="cl-e004b242">-100.0%</span></p></td><td class="cl-e00cfa25"><p class="cl-e00c9fc0"><span class="cl-e004b242">-100.0%</span></p></td><td class="cl-e00cfa2e"><p class="cl-e00c9fc0"><span class="cl-e004b242">269.4%</span></p></td><td class="cl-e00cfa2e"><p class="cl-e00c9fc0"><span class="cl-e004b242">332.7%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-e00cf9fc"><p class="cl-e00c9fc0"><span class="cl-e004b242">Type 2</span>NA</p></td><td class="cl-e00cfa38"><p class="cl-e00c9fc0"><span class="cl-e004b242">-25.3%</span></p></td><td class="cl-e00cfa42"><p class="cl-e00c9fc0"><span class="cl-e004b242">-2.7%</span></p></td><td class="cl-e00cfa43"><p class="cl-e00c9fc0"><span class="cl-e004b242">-41.8%</span></p></td><td class="cl-e00cfa4c"><p class="cl-e00c9fc0"><span class="cl-e004b242">81.2%</span></p></td><td class="cl-e00cfa1a"><p class="cl-e00c9fc0"><span class="cl-e004b242">-2.1%</span></p></td><td class="cl-e00cfa56"><p class="cl-e00c9fc0"><span class="cl-e004b242">16.2%</span></p></td><td class="cl-e00cfa25"><p class="cl-e00c9fc0"><span class="cl-e004b242">-100.0%</span></p></td><td class="cl-e00cfa25"><p class="cl-e00c9fc0"><span class="cl-e004b242">-100.0%</span></p></td><td class="cl-e00cfa57"><p class="cl-e00c9fc0"><span class="cl-e004b242">264.9%</span></p></td><td class="cl-e00cfa57"><p class="cl-e00c9fc0"><span class="cl-e004b242">327.2%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-e00cf9fc"><p class="cl-e00c9fc0"><span class="cl-e004b242">Type 3</span>NA</p></td><td class="cl-e00cfa60"><p class="cl-e00c9fc0"><span class="cl-e004b242">243,047.1%</span></p></td><td class="cl-e00cfa60"><p class="cl-e00c9fc0"><span class="cl-e004b242">19.8%</span></p></td><td class="cl-e00cfa60"><p class="cl-e00c9fc0"><span class="cl-e004b242">2,047,265.1%</span></p></td><td class="cl-e00cfa6a"><p class="cl-e00c9fc0"><span class="cl-e004b242">-86.6%</span></p></td><td class="cl-e00cfa60"><p class="cl-e00c9fc0"><span class="cl-e004b242">6.8%</span></p></td><td class="cl-e00cfa6b"><p class="cl-e00c9fc0"><span class="cl-e004b242">-89.9%</span></p></td><td class="cl-e00cfa25"><p class="cl-e00c9fc0"><span class="cl-e004b242">-100.0%</span></p></td><td class="cl-e00cfa25"><p class="cl-e00c9fc0"><span class="cl-e004b242">-100.0%</span></p></td><td class="cl-e00cfa25"><p class="cl-e00c9fc0"><span class="cl-e004b242">-100.0%</span></p></td><td class="cl-e00cfa74"><p class="cl-e00c9fc0"><span class="cl-e004b242">-98.7%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-e00cfa75"><p class="cl-e00c9fc0"><span class="cl-e004b242">Type 4</span>NA</p></td><td class="cl-e00cfa7e"><p class="cl-e00c9fc0"><span class="cl-e004b242">38,189.9%</span></p></td><td class="cl-e00cfa7f"><p class="cl-e00c9fc0"><span class="cl-e004b242">-3.6%</span></p></td><td class="cl-e00cfa88"><p class="cl-e00c9fc0"><span class="cl-e004b242">-88.8%</span></p></td><td class="cl-e00cfa92"><p class="cl-e00c9fc0"><span class="cl-e004b242">281.5%</span></p></td><td class="cl-e00cfa9c"><p class="cl-e00c9fc0"><span class="cl-e004b242">-3.1%</span></p></td><td class="cl-e00cfa92"><p class="cl-e00c9fc0"><span class="cl-e004b242">24.1%</span></p></td><td class="cl-e00cfa9d"><p class="cl-e00c9fc0"><span class="cl-e004b242">-100.0%</span></p></td><td class="cl-e00cfa9d"><p class="cl-e00c9fc0"><span class="cl-e004b242">-100.0%</span></p></td><td class="cl-e00cfa92"><p class="cl-e00c9fc0"><span class="cl-e004b242">378.7%</span></p></td><td class="cl-e00cfa92"><p class="cl-e00c9fc0"><span class="cl-e004b242">467.7%</span></p></td></tr></tbody></table></div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-parameter-estimation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Estimation of parameter variations in different patient subgroups, reported in <em>Table 8</em>, <span class="citation" data-cites="lo2016po">(<a href="#ref-lo2016po" role="doc-biblioref">Lo et al. 2016, 13</a>)</span><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.
</figcaption>
</figure>
</div>
</div>
<p>One of the major advantages of <code>flextable</code> lies in its ability to save the generated flextable object in a variety of formats, including <code>docx</code>, and <code>html</code>, as illustrated in <a href="#lst-flextable-output" class="quarto-xref">Listing&nbsp;3</a> (or even several ones simultaneously).</p>
<div class="cell" data-layout-align="center">
<div id="lst-flextable-output" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-flextable-output-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3: Flextable multiple outputs.
</figcaption>
<div aria-describedby="lst-flextable-output-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_as_html</span>(relative_parameter_variations_flextable,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">"../../results/Table8.html"</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Table 8: Parameter variations per disease subtype."</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">save_as_docx</span>(relative_parameter_variations_flextable,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">"../../results/Table8.docx"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Table 8: Parameter variations per disease subtype."</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</figure>
</div>
</div>
</section>
</section>
<section id="treatment-outcome-and-patient-stratification" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="treatment-outcome-and-patient-stratification"><span class="header-section-number">2</span> Treatment outcome and patient stratification</h2>
<p>The objective of this section is to predict the efficiency of a novel anti-TNF-<span class="math inline">\(\alpha\)</span> treatment, assuming that the blocking treatment is equivalent to force the concentration of TNF-<span class="math inline">\(\alpha\)</span> to remain zero, and calculate the change of other variables at the <strong>steady-state concentrations</strong>.</p>
<p>Second objective is to determine the efficiency of the treatment conditionned to the <em>patient endotype</em> determined using <em>patient stratification</em> approaches.</p>
<section id="load-free-parameter-variations-in-different-types-of-diseases" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="load-free-parameter-variations-in-different-types-of-diseases"><span class="header-section-number">2.1</span> Load Free Parameter variations in different types of diseases</h3>
<p><strong>Since the results of parameter estimation reported in <a href="#sec-parameter-estimation" class="quarto-xref">Section&nbsp;1.3</a> differ significantly from the results reported in the original paper, <em>Table 8</em>, <a href="https://journals.plos.org/plosone/article/figure?id=10.1371/journal.pone.0165782.t008"><span class="citation" data-cites="lo2016po">Lo et al. (<span>2016</span>)</span>, pp.&nbsp;13</a>, we directly retrieve in that section the original estimates from <span class="citation" data-cites="lo2016po">Lo et al. (<a href="#ref-lo2016po" role="doc-biblioref">2016</a>)</span></strong>.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Prepare parameter variations for each of the four patient subtypes ----</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>healthy_model <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">loadModel</span>(<span class="st">"../../models/team_2016_final_model_lo2016_2025_05_13.cps"</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># retrieve parameter mapping</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>parameters_per_clusters <span class="ot">&lt;-</span> <span class="fu">getParameters</span>(<span class="fu">c</span>(<span class="st">"(Prod of Ig from T1).k1"</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Prod of Ia from T1).k1"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Prod of Ib from Tr).k1"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Prod of I10 from Tr).v10r"</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Induction of T1 from M).s12"</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Induction of T2).s4"</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Induction of T17).s21"</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Induction of T17).s6"</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Induction of Tr).sb"</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Induction of Tr).s10"</span>), <span class="at">model =</span> healthy_model)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># retrieve parameter variations specific to each disease subtype ...</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>patient_group <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Type1"</span>, <span class="st">"Type2"</span>, <span class="st">"Type3"</span>, <span class="st">"Type4"</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>parameters_per_clusters <span class="ot">&lt;-</span> parameters_per_clusters <span class="sc">|&gt;</span> </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"../../data/IBD subgroups.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>), <span class="at">by =</span> <span class="st">"key"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">healthy =</span> value) <span class="sc">|&gt;</span> </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>mapping) <span class="sc">|&gt;</span> </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ... and convert relative ratios to absolute</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(patient_group), \(x) healthy <span class="sc">*</span>  (<span class="dv">1</span> <span class="sc">+</span> x<span class="sc">/</span><span class="dv">100</span>)))</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># run healthy steady state</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>healthy_steaty_state <span class="ot">&lt;-</span> <span class="fu">runSteadyState</span>(</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">calculate_jacobian =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> healthy_model)<span class="sc">$</span>species <span class="sc">|&gt;</span> </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name, <span class="at">concentrationH =</span> concentration) <span class="sc">|&gt;</span> </span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"I6"</span>, <span class="st">"I10"</span>, <span class="st">"Ia"</span>, <span class="st">"T1"</span>, <span class="st">"T2"</span>,<span class="st">"T17"</span>, <span class="st">"Tr"</span>, <span class="st">"Ig"</span>, <span class="st">"Ib"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="model-the-effect-of-tnf-alpha-blockade" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="model-the-effect-of-tnf-alpha-blockade"><span class="header-section-number">2.2</span> Model the effect of TNF-alpha blockade</h3>
<div class="sourceCode" id="annotated-cell-10"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-10-1"><a href="#annotated-cell-10-1" aria-hidden="true" tabindex="-1"></a>steady_states_per_cluster <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(patient_group, <span class="cf">function</span>(cluster) {</span>
<span id="annotated-cell-10-2"><a href="#annotated-cell-10-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># without anti-TNF alpha treatment</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="1">1</button><span id="annotated-cell-10-3" class="code-annotation-target"><a href="#annotated-cell-10-3" aria-hidden="true" tabindex="-1"></a>  disease_model_without_treatment <span class="ot">&lt;-</span> healthy_model <span class="sc">|&gt;</span> <span class="fu">saveModelToString</span>() <span class="sc">|&gt;</span>  <span class="fu">loadModelFromString</span>()</span>
<span id="annotated-cell-10-4"><a href="#annotated-cell-10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setParameters</span>(<span class="at">model =</span> disease_model_without_treatment,</span>
<span id="annotated-cell-10-5"><a href="#annotated-cell-10-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">key =</span> parameters_per_clusters<span class="sc">$</span>key,</span>
<span id="annotated-cell-10-6"><a href="#annotated-cell-10-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">value =</span> parameters_per_clusters[[cluster]])</span>
<span id="annotated-cell-10-7"><a href="#annotated-cell-10-7" aria-hidden="true" tabindex="-1"></a>  without_treatment_steady_state <span class="ot">&lt;-</span> <span class="fu">runSteadyState</span>(</span>
<span id="annotated-cell-10-8"><a href="#annotated-cell-10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">calculate_jacobian =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-10-9"><a href="#annotated-cell-10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> disease_model_without_treatment)<span class="sc">$</span>species <span class="sc">|&gt;</span></span>
<span id="annotated-cell-10-10"><a href="#annotated-cell-10-10" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(name, concentration) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-10-11"><a href="#annotated-cell-10-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(healthy_steaty_state, <span class="at">by =</span> <span class="st">"name"</span>) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-10-12"><a href="#annotated-cell-10-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span> (<span class="at">concentration =</span> <span class="dv">100</span><span class="sc">*</span> (concentration <span class="sc">-</span> concentrationH) <span class="sc">/</span> concentrationH) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-10-13"><a href="#annotated-cell-10-13" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>concentrationH) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-10-14"><a href="#annotated-cell-10-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cluster =</span> cluster, <span class="at">category =</span> <span class="st">"untreated"</span>)</span>
<span id="annotated-cell-10-15"><a href="#annotated-cell-10-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-10-16"><a href="#annotated-cell-10-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># with anti-TNF alpha treatment</span></span>
<span id="annotated-cell-10-17"><a href="#annotated-cell-10-17" aria-hidden="true" tabindex="-1"></a>  disease_model_with_treatment <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(disease_model_without_treatment <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-10-18"><a href="#annotated-cell-10-18" aria-hidden="true" tabindex="-1"></a>                                                     <span class="fu">saveModelToString</span>() <span class="sc">|&gt;</span>  </span>
<span id="annotated-cell-10-19"><a href="#annotated-cell-10-19" aria-hidden="true" tabindex="-1"></a>                                                     <span class="fu">loadModelFromString</span>())</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="2">2</button><span id="annotated-cell-10-20" class="code-annotation-target"><a href="#annotated-cell-10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setSpecies</span>(<span class="at">key =</span> <span class="st">"Ia{compartment}"</span>,</span>
<span id="annotated-cell-10-21"><a href="#annotated-cell-10-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">initial_concentration =</span> <span class="dv">0</span>,</span>
<span id="annotated-cell-10-22"><a href="#annotated-cell-10-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">type =</span><span class="st">"fixed"</span>,</span>
<span id="annotated-cell-10-23"><a href="#annotated-cell-10-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">model =</span> disease_model_with_treatment)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="3">3</button><span id="annotated-cell-10-24" class="code-annotation-target"><a href="#annotated-cell-10-24" aria-hidden="true" tabindex="-1"></a>  with_treatment_steady_state <span class="ot">&lt;-</span> <span class="fu">runSteadyState</span>(</span>
<span id="annotated-cell-10-25"><a href="#annotated-cell-10-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">calculate_jacobian =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-10-26"><a href="#annotated-cell-10-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> disease_model_with_treatment)<span class="sc">$</span>species <span class="sc">|&gt;</span></span>
<span id="annotated-cell-10-27"><a href="#annotated-cell-10-27" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(name, concentration) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-10-28"><a href="#annotated-cell-10-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(healthy_steaty_state, <span class="at">by =</span> <span class="st">"name"</span>) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-10-29"><a href="#annotated-cell-10-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span> (<span class="at">concentration =</span> <span class="dv">100</span><span class="sc">*</span> (concentration <span class="sc">-</span> concentrationH) <span class="sc">/</span> concentrationH) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-10-30"><a href="#annotated-cell-10-30" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>concentrationH) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-10-31"><a href="#annotated-cell-10-31" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">add_row</span>(<span class="at">name =</span> <span class="st">"Ia"</span>, <span class="at">concentration =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-10-32"><a href="#annotated-cell-10-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cluster =</span> cluster, <span class="at">category =</span> <span class="st">"treated"</span>)</span>
<span id="annotated-cell-10-33"><a href="#annotated-cell-10-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-10-34"><a href="#annotated-cell-10-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="fu">rbind</span>(without_treatment_steady_state, with_treatment_steady_state))</span>
<span id="annotated-cell-10-35"><a href="#annotated-cell-10-35" aria-hidden="true" tabindex="-1"></a>  </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="4">4</button><span id="annotated-cell-10-36" class="code-annotation-target"><a href="#annotated-cell-10-36" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="3,4,5,6,7,8,9,10,11,12,13,14" data-code-annotation="1">Estimate <em>steady-state</em> conditions for each of the four patient subgroups identified, without anti-TNF-<span class="math inline">\(\alpha\)</span> treatment.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="20,21,22,23" data-code-annotation="2">Constrain TNF-<span class="math inline">\(\alpha\)</span> to remain <code>fixed</code> and <strong>null</strong> by setting the initial concentration level to <span class="math inline">\(0\)</span>. <strong>Both parameters are required</strong> to ensure absence of TNF-<span class="math inline">\(\alpha\)</span>.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="24,25,26,27,28,29,30,31,32" data-code-annotation="3">Predict the new <em>steady-state</em> conditions after therapeutic treatment.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="36" data-code-annotation="4"><code>dplyr::bind_rows()</code> merges a list of <code>data.frame</code> into a single one.</span>
</dd>
</dl>
</section>
<section id="simulation-visualisations-of-the-fold-changes-of-the-cytokine-and-t-cell-concentrations" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="simulation-visualisations-of-the-fold-changes-of-the-cytokine-and-t-cell-concentrations"><span class="header-section-number">2.3</span> Simulation visualisations of the fold changes of the cytokine and T cell concentrations</h3>
<p>We have reproduced <em>Fig.3</em> from <span class="citation" data-cites="lo2016po">Lo et al. (<a href="#ref-lo2016po" role="doc-biblioref">2016</a>)</span>, pp.&nbsp;13, in <a href="#fig-treatment-blockade" class="quarto-xref">Figure&nbsp;1</a>, using a combination of <code>ggplot2</code>for individual barplot representations and <code>cowplot</code> for individual ‘ggplot’ concatenations.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproduce boxplots of Figure 3, pre and post-treatment ----</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Format dataset for plotting</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>steady_states_per_cluster_plot <span class="ot">&lt;-</span> steady_states_per_cluster <span class="sc">|&gt;</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">name =</span> <span class="fu">factor</span> (name, </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"I6"</span>, <span class="st">"I10"</span>, <span class="st">"Ia"</span>,  <span class="st">"T1"</span>, <span class="st">"T2"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"T17"</span>, <span class="st">"Tr"</span>, <span class="st">"Ig"</span>, <span class="st">"Ib"</span>),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"IL-6"</span>, <span class="st">"IL-10"</span>, <span class="st">"TNF-alpha"</span>, <span class="st">"Th1"</span>, <span class="st">"Th2"</span>, </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Th17"</span>, <span class="st">"Treg"</span>, <span class="st">"IFN-gamma"</span>, <span class="st">"TFG-beta"</span>), </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ordered =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">category  =</span> <span class="fu">factor</span>(category, </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"untreated"</span>, <span class="st">"treated"</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>cluster_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Type 1: Th1</span><span class="sc">\\</span><span class="st">uparrow Th2</span><span class="sc">\\</span><span class="st">downarrow"</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Type 2: Th1</span><span class="sc">\\</span><span class="st">downarrow Th2</span><span class="sc">\\</span><span class="st">uparrow"</span>, </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Type 3: Th1</span><span class="sc">\\</span><span class="st">uparrow Th2</span><span class="sc">\\</span><span class="st">uparrow"</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Type 4: Th1</span><span class="sc">\\</span><span class="st">downarrow Th2</span><span class="sc">\\</span><span class="st">downarrow"</span>) </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cluster_labels) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Type1"</span>, <span class="st">"Type2"</span>, <span class="st">"Type3"</span>, <span class="st">"Type4"</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="do">### Retrieve legend ----</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>global_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> steady_states_per_cluster_plot, </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>                      <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> concentration, <span class="at">fill =</span> category)) <span class="sc">+</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span><span class="st">"Treatment"</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>)) <span class="sc">+</span> </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) </span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="do">### Generate bar plot for each disease subtype ----</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>list_plots <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">imap</span>(cluster_labels, <span class="sc">~</span> <span class="fu">ggplot</span>(<span class="at">data =</span> steady_states_per_cluster_plot <span class="sc">|&gt;</span> <span class="fu">filter</span>(cluster<span class="sc">==</span>.y), </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> concentration, <span class="at">fill =</span> category)) <span class="sc">+</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>)<span class="sc">+</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">scale_fill_manual</span>(<span class="at">name =</span><span class="st">"Treatment"</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ggtitle</span>(<span class="fu">TeX</span>(.x)))</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="do">### Combine barplots into a 2x2 grid ----</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>plot_grid_combined <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> list_plots, </span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">align =</span> <span class="st">"hv"</span>, <span class="at">axis =</span> <span class="st">"tblr"</span>) </span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>x_label <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span> <span class="fu">draw_label</span>(<span class="st">"Cell Species"</span>, <span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fl">0.5</span>)</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>y_label <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span> <span class="fu">draw_label</span>(<span class="st">"ODE Parameters"</span>, <span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fl">0.5</span>, <span class="at">angle =</span> <span class="dv">90</span>)</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Add global y label</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>plot_grid_combined <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(y_label,</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  plot_grid_combined,</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>)  <span class="co"># Adjust width for the legend</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>legend_plot <span class="ot">&lt;-</span> <span class="fu">get_legend_temp</span>(global_plot)</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Add global x label</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>plot_grid_combined <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(plot_grid_combined, </span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>                   x_label,</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>                   legend_plot,</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span><span class="dv">1</span>,</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>)  <span class="co"># Adjust width for the legend</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>plot_grid_combined <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>  plot_grid_combined,</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>  legend_plot,</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>)  <span class="co"># Adjust width for the legend</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>plot_grid_combined</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-treatment-blockade" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-treatment-blockade-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="patient_stratification_files/figure-html/fig-treatment-blockade-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:95.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-treatment-blockade-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Simulation results of the <strong>fold changes</strong> of the cytokine and T-cell concentrations when TNF-<span class="math inline">\(\alpha\)</span> is completely blocked in the four group of identified patients. Blue bars represent the results of pre-treatment; red bars represent the results of post-treatment with TNF-<span class="math inline">\(\alpha\)</span> blockage. Reproduction of <span class="citation" data-cites="lo2016po">(<a href="#ref-lo2016po" role="doc-biblioref">Lo et al. 2016, 13</a>)</span>, Fig.3.
</figcaption>
</figure>
</div>
</div>
</div>


<!-- -->


</section>
</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-lo2016po" class="csl-entry" role="listitem">
Lo, Wing-Cheong, Violeta Arsenescu, Razvan I. Arsenescu, and Avner Friedman. 2016. <span>“Inflammatory <span>Bowel Disease</span>: <span class="nocase">How Effective Is TNF-α Suppression</span>?”</span> <em>PloS One</em> 11 (11): e0165782. <a href="https://doi.org/10.1371/journal.pone.0165782">https://doi.org/10.1371/journal.pone.0165782</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>note the final <code>split()</code> instruction: indeed, the expected input is a list of experiences, each element of the list matching a subgroup of patients with their own set of free parameters<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>In contrast with documentation, this step seems mandatory, as the output returned by `` has a <strong>placeholder</strong> typical syntax.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p><a href="https://doi.org/10.1371/journal.pone.0165782.t008">Webshot table</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/bastienchassagnol\.github\.io\/Lo2016_ODE_IBD");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../reproducibility/prcc.html" class="pagination-link" aria-label="PRCC">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">PRCC</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb9" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Patient stratification"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>The list of packages required for reproducing the analyses on this script are listed in @lst-setup-patient-stratification. Besides, the downloadable R script file <span class="co">[</span><span class="ot">`utils`</span><span class="co">](../../scripts/utils.R)</span> stores two helper functions:</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`get_legend_temp`</span> is a temporary fix to retrieve the legend of any <span class="in">`ggplot2`</span> or <span class="in">`grob`</span> object (used for further customisation of a panel of subplots). For further details on this custom fix, report to <span class="co">[</span><span class="ot">Open `Cowplot` Issue for shared legend feature</span><span class="co">](https://github.com/wilkelab/cowplot/issues/202)</span>.</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`colourer`</span> is a custom styling function displaying all positive values as *red*, and negative ones as *blue* (used with <span class="in">`flextable`</span>).</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup-stratif</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">#| lst-label: lst-setup-patient-stratification</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">#| lst-cap: Packages required for analysing biological differences between patient conditions.</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(CoRC)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Data wrangling</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Table visualisation</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot visualisation</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(latex2exp)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../../scripts/utils.R"</span>)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="fu">## Parameter estimation and patient stratification</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>To run an experimental design, we need:</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>the model itself, and notably the steady-state concentrations, and the parameter constants. </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Experimental data, where for a given condition (here, patient cluster), the columns correspond to the species concentrations, and the rows to the indiviudal observations. Real-life measures of fold changes have been reported in @tbl-experiment-data.</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The R code used for loading the healthy model and the clinical datasets, is reported in @lst-load-experiences^<span class="co">[</span><span class="ot">note the final `split()` instruction: indeed, the expected input is a list of experiences, each element of the list matching a subgroup of patients with their own set of free parameters</span><span class="co">]</span>.</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="fu">### Differential analyses</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>**Note that @lo2016po did not provide unfortunately the individual cytokine concentrations, preventing from reproducing the differential analyses and quite hampering the validity of [Parameter estimation](https://copasi.org/Support/User_Manual/Tasks/Parameter_Estimation/) Task.**</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="co">#| lst-label: lst-load-experiences</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-healthy</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="co">#| lst-cap: Code snippet not run, used for illustration example. </span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Healthy ODE model along with the parameter constants</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>healthy_model <span class="ot">&lt;-</span> <span class="fu">loadModel</span>(<span class="st">"../../models/team_2016_final_model_lo2016_2025_05_13.cps"</span>)</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>healthy_steaty_state <span class="ot">&lt;-</span> <span class="fu">runSteadyState</span>(</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">calculate_jacobian =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> healthy_model</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>)<span class="sc">$</span>species <span class="sc">|&gt;</span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name, <span class="at">concentrationH =</span> concentration)</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Load experimental datasets providing real-life concentrations of cytokines</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>cluster_type <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Type 1"</span>, <span class="st">"Type 2"</span>, <span class="st">"Type 3"</span>, <span class="st">"Type 4"</span>)</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>data_experiment <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"../../data/IBD DGEA.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">!</span>cluster, <span class="at">names_to =</span> <span class="st">"name"</span>, <span class="at">values_to =</span> <span class="st">"concentration"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(healthy_steaty_state, <span class="at">by =</span> <span class="st">"name"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">concentration =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(concentrationH),</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>                            concentrationH <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> concentration <span class="sc">/</span> <span class="dv">100</span>), concentration</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">concentrationH =</span> <span class="cn">NULL</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> name, <span class="at">values_from =</span> concentration) <span class="sc">|&gt;</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(<span class="at">f =</span> cluster_type)</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-experiment-data</span></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Fold changes of *cytokine* concentrations obtained from clinical data, reported in *Table 7*, [@lo2016po, pp. 13]. `Species` is the cytokines' name,  while cluster indicator is returned by `Types of disease`. Note that we have not reported species concentrations of $T-Bet$, $Gata3$, $ROR \gamma t$, and $Foxp3$ as not measured in the ODE model. </span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>data_experiment_displayed <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"../../data/IBD DGEA.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">!</span>cluster, <span class="at">names_to =</span> <span class="st">"name"</span>, <span class="at">values_to =</span> <span class="st">"concentration"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(healthy_steaty_state, <span class="at">by =</span> <span class="st">"name"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">fold change</span><span class="st">`</span><span class="ot">=</span> concentration, </span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>         <span class="at">concentration =</span> concentrationH <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> concentration <span class="sc">/</span> <span class="dv">100</span>), </span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>         <span class="at">concentrationH =</span>   <span class="fu">formatC</span>(concentrationH, <span class="at">format =</span> <span class="st">"e"</span>, <span class="at">digits =</span> <span class="dv">2</span>), </span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>         <span class="at">concentration =</span> <span class="fu">formatC</span>(concentration, <span class="at">format =</span> <span class="st">"e"</span>, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(concentrationH, <span class="at">.before =</span> concentration)</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"Species"</span>,  <span class="at">cluster =</span> <span class="st">"Types of disease"</span>, </span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>  <span class="at">concentrationH =</span> <span class="st">"Species' concentration at steady-state"</span>,</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>  <span class="at">concentration =</span> <span class="st">"Concentrations in IBD clusters"</span>)</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a><span class="fu">flextable</span>(data_experiment_displayed) <span class="sc">|&gt;</span> </span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colformat_double</span>(<span class="at">j =</span> <span class="fu">c</span>(<span class="st">"fold change"</span>), <span class="at">suffix =</span><span class="st">"%"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_header_labels</span>(<span class="at">values =</span> labels) <span class="sc">|&gt;</span> </span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">footnote</span>(<span class="at">j =</span> <span class="st">"name"</span>, <span class="at">i =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">14</span>, <span class="dv">15</span>, <span class="dv">19</span>, <span class="dv">20</span>),</span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>           <span class="at">value =</span> <span class="fu">as_paragraph</span>(<span class="st">"These quantities have not been measured, but rather estimated from the model."</span>),</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>           <span class="at">part =</span> <span class="st">"body"</span>,   <span class="at">ref_symbols =</span> <span class="fu">c</span>(<span class="st">"*"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_caption</span>(<span class="st">"Table 7: Fold changes of the cytokine and T cell concentrations obtained from clinical data."</span>)</span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a><span class="fu">### Configure the experimental design and the numerical optimisations</span></span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: define-experiences</span></span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a><span class="co">#| # define the free parameters ----</span></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a><span class="co"># define larger lower and upper bounds</span></span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>free_parameters_key <span class="ot">&lt;-</span> <span class="fu">getParameters</span>(<span class="fu">c</span>(</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Prod of Ig from T1).k1"</span>,</span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Prod of Ia from T1).k1"</span>,</span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Prod of Ib from Tr).k1"</span>,</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Prod of I10 from Tr).v10r"</span>,</span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Induction of T1 from M).s12"</span>,</span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Induction of T2).s4"</span>,</span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Induction of T17).s21"</span>,</span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Induction of T17).s6"</span>,</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Induction of Tr).sb"</span>,</span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Induction of Tr).s10"</span></span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a>), <span class="at">model =</span> healthy_model)<span class="sc">$</span>key</span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a>fit_parameters <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(free_parameters_key, <span class="cf">function</span>(param) {</span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a>  val <span class="ot">&lt;-</span> <span class="fu">getParameters</span>(param)<span class="sc">$</span>value</span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">defineParameterEstimationParameter</span>(</span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a>    <span class="at">ref =</span> <span class="fu">parameter</span>(param, <span class="st">"Value"</span>),</span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_value =</span> val,</span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower_bound =</span> <span class="fl">1e-15</span>,</span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper_bound =</span> <span class="fl">1e4</span></span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a>mapping_present <span class="ot">&lt;-</span> <span class="fu">getSpeciesReferences</span>(</span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a>  <span class="at">key =</span> <span class="fu">c</span>(<span class="st">"I6"</span>, <span class="st">"I10"</span>, <span class="st">"Ia"</span>, <span class="st">"Ib"</span>, <span class="st">"Ig"</span>),</span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> healthy_model</span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(concentration)</span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a>fit_experiments <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(data_experiment, <span class="sc">~</span> <span class="fu">defineExperiments</span>(</span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>  <span class="at">experiment_type =</span> <span class="st">"steady_state"</span>,</span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> .x,</span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a>  <span class="at">types =</span> <span class="fu">c</span>(</span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ignore"</span>, <span class="st">"dependent"</span>, <span class="st">"dependent"</span>, <span class="st">"dependent"</span>,</span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ignore"</span>, <span class="st">"ignore"</span>, <span class="st">"ignore"</span>, <span class="st">"ignore"</span>, <span class="st">"ignore"</span>, <span class="st">"ignore"</span></span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a>  <span class="at">mappings =</span> <span class="fu">c</span>(<span class="cn">NA</span>, mapping_present,  <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">4</span>)),</span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_method =</span> <span class="st">"mean_square"</span></span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a>free_parameters_key <span class="ot">&lt;-</span> <span class="fu">getParameters</span>(<span class="fu">c</span>(<span class="st">"(Prod of Ig from T1).k1"</span>,          <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Prod of Ia from T1).k1"</span>,          <span class="co"># &lt;1&gt;                             </span></span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Prod of Ib from Tr).k1"</span>,          <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Prod of I10 from Tr).v10r"</span>,       <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Induction of T1 from M).s12"</span>,     <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Induction of T2).s4"</span>,             <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-166"><a href="#cb9-166" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Induction of T17).s21"</span>,           <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-167"><a href="#cb9-167" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Induction of T17).s6"</span>,            <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-168"><a href="#cb9-168" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Induction of Tr).sb"</span>,              <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-169"><a href="#cb9-169" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"(Induction of Tr).s10"</span>), <span class="at">model =</span> healthy_model)<span class="sc">$</span>key <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-170"><a href="#cb9-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-171"><a href="#cb9-171" aria-hidden="true" tabindex="-1"></a>fit_parameters <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(free_parameters_key, <span class="cf">function</span>(param) {        <span class="co"># &lt;2&gt;</span></span>
<span id="cb9-172"><a href="#cb9-172" aria-hidden="true" tabindex="-1"></a>  val <span class="ot">&lt;-</span> <span class="fu">getParameters</span>(param)<span class="sc">$</span>value                                        <span class="co"># &lt;2&gt;</span></span>
<span id="cb9-173"><a href="#cb9-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">defineParameterEstimationParameter</span>(                                      <span class="co"># &lt;2&gt;</span></span>
<span id="cb9-174"><a href="#cb9-174" aria-hidden="true" tabindex="-1"></a>    <span class="at">ref =</span> <span class="fu">parameter</span>(param, <span class="st">"Value"</span>),                                       <span class="co"># &lt;2&gt;</span></span>
<span id="cb9-175"><a href="#cb9-175" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_value =</span> val,                                                     <span class="co"># &lt;2&gt;</span></span>
<span id="cb9-176"><a href="#cb9-176" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower_bound =</span> <span class="fl">1e-15</span>,                                                   <span class="co"># &lt;2&gt;</span></span>
<span id="cb9-177"><a href="#cb9-177" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper_bound =</span> <span class="fl">1e4</span>)                                                     <span class="co"># &lt;2&gt;</span></span>
<span id="cb9-178"><a href="#cb9-178" aria-hidden="true" tabindex="-1"></a>})                                                                         <span class="co"># &lt;2&gt;</span></span>
<span id="cb9-179"><a href="#cb9-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-180"><a href="#cb9-180" aria-hidden="true" tabindex="-1"></a>mapping_present <span class="ot">&lt;-</span> <span class="fu">getSpeciesReferences</span>(</span>
<span id="cb9-181"><a href="#cb9-181" aria-hidden="true" tabindex="-1"></a>  <span class="at">key =</span> <span class="fu">c</span>(<span class="st">"I6"</span>, <span class="st">"I10"</span>, <span class="st">"Ia"</span>, <span class="st">"Ib"</span>, <span class="st">"Ig"</span>),</span>
<span id="cb9-182"><a href="#cb9-182" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> healthy_model</span>
<span id="cb9-183"><a href="#cb9-183" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(concentration)</span>
<span id="cb9-184"><a href="#cb9-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-185"><a href="#cb9-185" aria-hidden="true" tabindex="-1"></a>fit_experiments <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(data_experiment, <span class="sc">~</span> <span class="fu">defineExperiments</span>( <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-186"><a href="#cb9-186" aria-hidden="true" tabindex="-1"></a>  <span class="at">experiment_type =</span> <span class="st">"steady_state"</span>, <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-187"><a href="#cb9-187" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> .x, <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-188"><a href="#cb9-188" aria-hidden="true" tabindex="-1"></a>  <span class="at">types =</span> <span class="fu">c</span>( <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-189"><a href="#cb9-189" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ignore"</span>, <span class="st">"dependent"</span>, <span class="st">"dependent"</span>, <span class="st">"dependent"</span>, <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-190"><a href="#cb9-190" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ignore"</span>, <span class="st">"ignore"</span>, <span class="st">"ignore"</span>, <span class="st">"ignore"</span>, <span class="st">"ignore"</span>, <span class="st">"ignore"</span>), <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-191"><a href="#cb9-191" aria-hidden="true" tabindex="-1"></a>  <span class="at">mappings =</span> <span class="fu">c</span>(<span class="cn">NA</span>, mapping_present,  <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">4</span>)), <span class="co"># &lt;4&gt;</span></span>
<span id="cb9-192"><a href="#cb9-192" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_method =</span> <span class="st">"mean_square"</span> <span class="co"># &lt;5&gt;</span></span>
<span id="cb9-193"><a href="#cb9-193" aria-hidden="true" tabindex="-1"></a>))            <span class="co"># &lt;3&gt;                 </span></span>
<span id="cb9-194"><a href="#cb9-194" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-195"><a href="#cb9-195" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>To adjust the variations of steady-state concentrations observed in the identified four subgroups of patients suffering from Inflammatory Bowel Disease, @lo2016po chose to play with 10 biological constants (10 degrees of freedom). Note that for the system of equations to be **determined** (at the very least), the number of free parameters to estimate must be equal or inferior to the number of equations (here, one by species included in the ODE model, aka 15).</span>
<span id="cb9-196"><a href="#cb9-196" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>We initialise the iterative search by initialising the 10 free parameters with the biological constant vitals observed in healthy inviduals. Besides, we can enforce bounds (either for each of the parameters, or shared by all of them), coercing the optimisation algorithm not to go beyond. </span>
<span id="cb9-197"><a href="#cb9-197" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>For each of the patient subgroups, we need to provide the type of experiment (either <span class="in">`steady-state`</span>, or <span class="in">`time_course`</span> when several time points have been considered in the design), the measured concentrations diverging from the average concentrations in healthy patients with <span class="in">`data`</span>, define each of the measured variables  (constant with <span class="in">`independent`</span>, <span class="in">`dependent`</span> if used for tailoring the parameter estimates, or <span class="in">`ignore`</span> if not quantified in the ODE model). We had only the averaged expression per patient subgroup To better capture within-patient variability, it would have been valuable to provide the individual cytokine profiles, and perform a <span class="co">[</span><span class="ot">**multiple least-squares regression, aka MMR**</span><span class="co">](https://en.wikipedia.org/wiki/General_linear_model)</span> task.</span>
<span id="cb9-198"><a href="#cb9-198" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span><span class="in">`mappings`</span> guarantees the proper pairing between COPASI variables and string values of column names^<span class="co">[</span><span class="ot">In contrast with documentation, this step seems mandatory, as the output returned by `` has a **placeholder** typical syntax.</span><span class="co">]</span>.</span>
<span id="cb9-199"><a href="#cb9-199" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Finally, the <span class="co">[</span><span class="ot">`weight_method`</span><span class="co">]</span> coupled with <span class="in">`weights`</span> describe for each variable the assumed mean-variation trend. Report to COPASI Manual, section <span class="co">[</span><span class="ot">*Experimental Data*</span><span class="co">](https://copasi.org/Support/User_Manual/Tasks/Parameter_Estimation/Experimental_Data/)</span>, for further details. </span>
<span id="cb9-200"><a href="#cb9-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-201"><a href="#cb9-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-202"><a href="#cb9-202" aria-hidden="true" tabindex="-1"></a>Finally, once the experimental design and optimisation criterias have been configured independently for each free parameter and patient subgroup, we have to run the parameter estimation itself:</span>
<span id="cb9-203"><a href="#cb9-203" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-206"><a href="#cb9-206" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-207"><a href="#cb9-207" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: runParameterEstimation</span></span>
<span id="cb9-208"><a href="#cb9-208" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb9-209"><a href="#cb9-209" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb9-210"><a href="#cb9-210" aria-hidden="true" tabindex="-1"></a>absolute_parameter_per_cluster <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(fit_experiments, <span class="cf">function</span>(cluster) {</span>
<span id="cb9-211"><a href="#cb9-211" aria-hidden="true" tabindex="-1"></a>  <span class="co"># CoRC update imposes to restart from a clean model for parameter estimation</span></span>
<span id="cb9-212"><a href="#cb9-212" aria-hidden="true" tabindex="-1"></a>  CoRC<span class="sc">::</span><span class="fu">clearParameterEstimationParameters</span>(<span class="at">model =</span> healthy_model)</span>
<span id="cb9-213"><a href="#cb9-213" aria-hidden="true" tabindex="-1"></a>  CoRC<span class="sc">::</span><span class="fu">clearExperiments</span>(<span class="at">model =</span> healthy_model)</span>
<span id="cb9-214"><a href="#cb9-214" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-215"><a href="#cb9-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">runParameterEstimation</span>(</span>
<span id="cb9-216"><a href="#cb9-216" aria-hidden="true" tabindex="-1"></a>    <span class="at">parameters =</span> fit_parameters,</span>
<span id="cb9-217"><a href="#cb9-217" aria-hidden="true" tabindex="-1"></a>    <span class="at">experiments =</span> cluster,</span>
<span id="cb9-218"><a href="#cb9-218" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="fu">list</span>(</span>
<span id="cb9-219"><a href="#cb9-219" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"LevenbergMarquardt"</span>,</span>
<span id="cb9-220"><a href="#cb9-220" aria-hidden="true" tabindex="-1"></a>      <span class="at">log_verbosity =</span> <span class="dv">0</span>, </span>
<span id="cb9-221"><a href="#cb9-221" aria-hidden="true" tabindex="-1"></a>      <span class="at">iteration_limit =</span> <span class="dv">200</span>,</span>
<span id="cb9-222"><a href="#cb9-222" aria-hidden="true" tabindex="-1"></a>      <span class="at">tolerance =</span> <span class="fl">1e-5</span></span>
<span id="cb9-223"><a href="#cb9-223" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb9-224"><a href="#cb9-224" aria-hidden="true" tabindex="-1"></a>    <span class="at">update_model =</span> <span class="cn">FALSE</span>, </span>
<span id="cb9-225"><a href="#cb9-225" aria-hidden="true" tabindex="-1"></a>    <span class="at">randomize_start_values =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-226"><a href="#cb9-226" aria-hidden="true" tabindex="-1"></a>    <span class="at">create_parameter_sets =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-227"><a href="#cb9-227" aria-hidden="true" tabindex="-1"></a>    <span class="at">calculate_statistics =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-228"><a href="#cb9-228" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> healthy_model</span>
<span id="cb9-229"><a href="#cb9-229" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">$</span>parameters)</span>
<span id="cb9-230"><a href="#cb9-230" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb9-231"><a href="#cb9-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-232"><a href="#cb9-232" aria-hidden="true" tabindex="-1"></a><span class="co"># Make results directly comparable with Table 8 by switchign from absolute to relative ratios</span></span>
<span id="cb9-233"><a href="#cb9-233" aria-hidden="true" tabindex="-1"></a>relative_parameter_per_cluster <span class="ot">&lt;-</span> absolute_parameter_per_cluster <span class="sc">|&gt;</span> </span>
<span id="cb9-234"><a href="#cb9-234" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">list_rbind</span>(<span class="at">names_to =</span> <span class="st">"cluster"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-235"><a href="#cb9-235" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(cluster, parameter, start_value, value) <span class="sc">|&gt;</span> </span>
<span id="cb9-236"><a href="#cb9-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">relative_concentration =</span> <span class="dv">100</span><span class="sc">*</span>(value <span class="sc">-</span> start_value)<span class="sc">/</span>start_value,</span>
<span id="cb9-237"><a href="#cb9-237" aria-hidden="true" tabindex="-1"></a>          <span class="at">start_value =</span> <span class="cn">NULL</span>, <span class="at">value =</span> <span class="cn">NULL</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-238"><a href="#cb9-238" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> parameter, <span class="at">values_from =</span> relative_concentration) </span>
<span id="cb9-239"><a href="#cb9-239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-240"><a href="#cb9-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-241"><a href="#cb9-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-242"><a href="#cb9-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-243"><a href="#cb9-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-244"><a href="#cb9-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-245"><a href="#cb9-245" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb9-246"><a href="#cb9-246" aria-hidden="true" tabindex="-1"></a>absolute_parameter_per_cluster <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(fit_experiments, <span class="cf">function</span>(cluster) { <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-247"><a href="#cb9-247" aria-hidden="true" tabindex="-1"></a>  CoRC<span class="sc">::</span><span class="fu">clearParameterEstimationParameters</span>(<span class="at">model =</span> healthy_model)   <span class="co"># &lt;2&gt;</span></span>
<span id="cb9-248"><a href="#cb9-248" aria-hidden="true" tabindex="-1"></a>  CoRC<span class="sc">::</span><span class="fu">clearExperiments</span>(<span class="at">model =</span> healthy_model)                     <span class="co"># &lt;2&gt;</span></span>
<span id="cb9-249"><a href="#cb9-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">runParameterEstimation</span>(                             <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-250"><a href="#cb9-250" aria-hidden="true" tabindex="-1"></a>    <span class="at">parameters =</span> fit_parameters, <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-251"><a href="#cb9-251" aria-hidden="true" tabindex="-1"></a>    <span class="at">experiments =</span> cluster, <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-252"><a href="#cb9-252" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"LevenbergMarquardt"</span>,   <span class="co"># &lt;4&gt;</span></span>
<span id="cb9-253"><a href="#cb9-253" aria-hidden="true" tabindex="-1"></a>                  <span class="at">iteration_limit =</span> <span class="dv">500</span>,   <span class="co"># &lt;4&gt;</span></span>
<span id="cb9-254"><a href="#cb9-254" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tolerance =</span> <span class="fl">1e-6</span>),   <span class="co"># &lt;4&gt;</span></span>
<span id="cb9-255"><a href="#cb9-255" aria-hidden="true" tabindex="-1"></a>    <span class="at">update_model =</span> <span class="cn">FALSE</span>, <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-256"><a href="#cb9-256" aria-hidden="true" tabindex="-1"></a>    <span class="at">randomize_start_values =</span> <span class="cn">FALSE</span>, <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-257"><a href="#cb9-257" aria-hidden="true" tabindex="-1"></a>    <span class="at">create_parameter_sets =</span> <span class="cn">TRUE</span>,  <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-258"><a href="#cb9-258" aria-hidden="true" tabindex="-1"></a>    <span class="at">calculate_statistics =</span> <span class="cn">FALSE</span>,  <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-259"><a href="#cb9-259" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> healthy_model  <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-260"><a href="#cb9-260" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">$</span>parameters)</span>
<span id="cb9-261"><a href="#cb9-261" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb9-262"><a href="#cb9-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-263"><a href="#cb9-263" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>We learn a configuration of 10 free parameters independently for each patient subgroup. </span>
<span id="cb9-264"><a href="#cb9-264" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Recall that in COPASI, models are modified by reference rather than by copy. These auxiliary functions, <span class="in">`clearParameterEstimationParameters`</span> and <span class="in">`clearExperiments`</span> guarantee a fresh start for parameter estimation for each scenario. </span>
<span id="cb9-265"><a href="#cb9-265" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>The core function, <span class="in">`runParameterEstimation`</span>, of the pipeline for estimating varying constants across distinct biological conditions. </span>
<span id="cb9-266"><a href="#cb9-266" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>There are plenty of optimisation approaches to reduce the discrepancy between the healthy-state concentrations of immune cells, and the ones observed across each patient cluster, listed in <span class="co">[</span><span class="ot">Optimization Methods</span><span class="co">](https://copasi.org/Support/User_Manual/Methods/Optimization_Methods/)</span>. **Unfortunately, the precise optimisation method used in @lo2016po has not been detailed, nor the hyperparameters used.** We arbitrarily chose the <span class="co">[</span><span class="ot">Levenberg - Marquardt</span><span class="co">](https://copasi.org/Support/User_Manual/Methods/Optimization_Methods/Levenberg_-_Marquardt/)</span> approach that is a good compromise between first-order, steepest descent approaches, and second-order, Newton-Raphson like approaches (see @tip-optimisation for details). The <span class="in">`iteration_limit`</span> determines the maximum number of iterations the algorithm shall perform, while <span class="in">`tolerance`</span> is the numerical precision to reach between two consecutive iterations.</span>
<span id="cb9-267"><a href="#cb9-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-268"><a href="#cb9-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-269"><a href="#cb9-269" aria-hidden="true" tabindex="-1"></a>::: {#tip-optimisation .callout-tip title="Optimisation Descent Methods" collapse="true"}</span>
<span id="cb9-270"><a href="#cb9-270" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-271"><a href="#cb9-271" aria-hidden="true" tabindex="-1"></a>Consider a multivariate function $f(\mathbf{x})$ that we want to **maximize** with respect to $\mathbf{x}$ (for instance, we may want to minimise the mean-squared error between estimated steady-state concentrations and ones measured in each patient subgroup). Standard unconstrained optimization approaches include *Gradient Descent* (see [@eq-GD]), *Newton-Raphson* (see [@eq-NR]) and *Levenbergh-Marquart* (see <span class="co">[</span><span class="ot">@eq-LM</span><span class="co">]</span>):</span>
<span id="cb9-272"><a href="#cb9-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-273"><a href="#cb9-273" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-274"><a href="#cb9-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-275"><a href="#cb9-275" aria-hidden="true" tabindex="-1"></a>The **Steepest Descent Approach**, where the method updates $\mathbf{x}$ in the direction of the gradient (steepest slope):  </span>
<span id="cb9-276"><a href="#cb9-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-277"><a href="#cb9-277" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb9-278"><a href="#cb9-278" aria-hidden="true" tabindex="-1"></a>\mathbf{x}_{k+1} = \mathbf{x}_k + \alpha_k \nabla f(\mathbf{x}_k)</span>
<span id="cb9-279"><a href="#cb9-279" aria-hidden="true" tabindex="-1"></a>$${#eq-GD}</span>
<span id="cb9-280"><a href="#cb9-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-281"><a href="#cb9-281" aria-hidden="true" tabindex="-1"></a>where:  </span>
<span id="cb9-282"><a href="#cb9-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-283"><a href="#cb9-283" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\nabla f(\mathbf{x}_k)$ is the gradient of $f$ at $\mathbf{x}_k$,  </span>
<span id="cb9-284"><a href="#cb9-284" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\alpha_k$ is the **step size (learning rate)**, sometimes fixed. Playing on this parameter may prevent revolving round the optimum.  </span>
<span id="cb9-285"><a href="#cb9-285" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**The steepest descent method only converges linearly, but is guaranteed to converge.**</span>
<span id="cb9-286"><a href="#cb9-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-287"><a href="#cb9-287" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-288"><a href="#cb9-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-289"><a href="#cb9-289" aria-hidden="true" tabindex="-1"></a>The **Newton-Raphson Approach** is a second-order method, requiring the computation of the *Hessian matrix*:  </span>
<span id="cb9-290"><a href="#cb9-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-291"><a href="#cb9-291" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb9-292"><a href="#cb9-292" aria-hidden="true" tabindex="-1"></a>\mathbf{x}_{k+1} = \mathbf{x}_k +  \mathbf{H}^{-1}(\mathbf{x}_k) \nabla f(\mathbf{x}_k)</span>
<span id="cb9-293"><a href="#cb9-293" aria-hidden="true" tabindex="-1"></a>$${#eq-NR}</span>
<span id="cb9-294"><a href="#cb9-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-295"><a href="#cb9-295" aria-hidden="true" tabindex="-1"></a>where:  </span>
<span id="cb9-296"><a href="#cb9-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-297"><a href="#cb9-297" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\mathbf{H}(\mathbf{x}_k) = \nabla^2 f(\mathbf{x}_k)$ is the Hessian matrix,  </span>
<span id="cb9-298"><a href="#cb9-298" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\nabla f(\mathbf{x}_k)$ is the gradient.</span>
<span id="cb9-299"><a href="#cb9-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-300"><a href="#cb9-300" aria-hidden="true" tabindex="-1"></a>**On the other hand, the Newton method converges quadratically towards the minimum in its vicinity. However, it's really sensible to the initialisation, and may not converge at all if it is far away from it**.</span>
<span id="cb9-301"><a href="#cb9-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-302"><a href="#cb9-302" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-303"><a href="#cb9-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-304"><a href="#cb9-304" aria-hidden="true" tabindex="-1"></a>The **Levenberg-Marquardt Descent Approach** blends Newton’s method with a trust-region adjustment, controlling step size:</span>
<span id="cb9-305"><a href="#cb9-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-306"><a href="#cb9-306" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb9-307"><a href="#cb9-307" aria-hidden="true" tabindex="-1"></a>\mathbf{x}_{k+1} = \mathbf{x}_k + \left( \mathbf{H}(\mathbf{x}_k) + \lambda \mathbf{I} \right)^{-1} \nabla f(\mathbf{x}_k)</span>
<span id="cb9-308"><a href="#cb9-308" aria-hidden="true" tabindex="-1"></a>$${#eq-LM}</span>
<span id="cb9-309"><a href="#cb9-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-310"><a href="#cb9-310" aria-hidden="true" tabindex="-1"></a>where $\lambda$ controls the trade-off between gradient descent, when $\lambda \to \infty$, and Newton’s method $\lambda \to 0$.  </span>
<span id="cb9-311"><a href="#cb9-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-312"><a href="#cb9-312" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-313"><a href="#cb9-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-314"><a href="#cb9-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-315"><a href="#cb9-315" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reporting of parameter estimations{#sec-parameter-estimation}</span></span>
<span id="cb9-316"><a href="#cb9-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-317"><a href="#cb9-317" aria-hidden="true" tabindex="-1"></a>Our estimations are compared with *Table 8*, <span class="co">[</span><span class="ot">@lo2016po, pp. 13</span><span class="co">]</span> variations in @tbl-parameter-estimation. </span>
<span id="cb9-318"><a href="#cb9-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-319"><a href="#cb9-319" aria-hidden="true" tabindex="-1"></a>**Of note, all tables in the original paper were provided as screenshots and images, rather than CSV files, preventing straightforward reporducibility of the results**.</span>
<span id="cb9-320"><a href="#cb9-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-321"><a href="#cb9-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-324"><a href="#cb9-324" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-325"><a href="#cb9-325" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-parameter-estimation</span></span>
<span id="cb9-326"><a href="#cb9-326" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb9-327"><a href="#cb9-327" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Estimation of parameter variations in different patient subgroups, reported in *Table 8*, [@lo2016po, pp. 13]^[[Webshot table](https://doi.org/10.1371/journal.pone.0165782.t008)].</span></span>
<span id="cb9-328"><a href="#cb9-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-329"><a href="#cb9-329" aria-hidden="true" tabindex="-1"></a><span class="co"># flextable formatting and variables</span></span>
<span id="cb9-330"><a href="#cb9-330" aria-hidden="true" tabindex="-1"></a>variable_labels <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-331"><a href="#cb9-331" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster =</span> <span class="st">"Type of diseases"</span>,</span>
<span id="cb9-332"><a href="#cb9-332" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Prod of Ig from T1).k1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"coefficient of IFN-gamma by Th1"</span>, </span>
<span id="cb9-333"><a href="#cb9-333" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Prod of Ia from T1).k1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"coefficient of TNF-alpha by Th1"</span>, </span>
<span id="cb9-334"><a href="#cb9-334" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Prod of Ib from Tr).k1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"coefficient of TGF-beta by Treg"</span>,</span>
<span id="cb9-335"><a href="#cb9-335" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Prod of I10 from Tr).v10r</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"coefficient of IL-10 by Treg"</span>,</span>
<span id="cb9-336"><a href="#cb9-336" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Induction of T1 from M).s12</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"activation of Th1 cells"</span>, </span>
<span id="cb9-337"><a href="#cb9-337" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Induction of T2).s4</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"activation of Th2 cells"</span>, </span>
<span id="cb9-338"><a href="#cb9-338" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Induction of T17).s21</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"activation of Th17 cells"</span>,</span>
<span id="cb9-339"><a href="#cb9-339" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Induction of T17).s6</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"activation of Th17 cells"</span>, </span>
<span id="cb9-340"><a href="#cb9-340" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Induction of Tr).sb</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"activation of Treg cells"</span>,</span>
<span id="cb9-341"><a href="#cb9-341" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Induction of Tr).s10</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"activation of Treg cells"</span></span>
<span id="cb9-342"><a href="#cb9-342" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-343"><a href="#cb9-343" aria-hidden="true" tabindex="-1"></a>header_row <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb9-344"><a href="#cb9-344" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">text{Type of diseases}"</span>,</span>
<span id="cb9-345"><a href="#cb9-345" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">nu_{</span><span class="sc">\\</span><span class="st">gamma_1}"</span>,</span>
<span id="cb9-346"><a href="#cb9-346" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">nu_{</span><span class="sc">\\</span><span class="st">alpha_1}"</span>, </span>
<span id="cb9-347"><a href="#cb9-347" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">nu_{</span><span class="sc">\\</span><span class="st">beta_{</span><span class="sc">\\</span><span class="st">rho}}"</span>,</span>
<span id="cb9-348"><a href="#cb9-348" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">nu_{10_{</span><span class="sc">\\</span><span class="st">rho}}"</span>,</span>
<span id="cb9-349"><a href="#cb9-349" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">sigma_{12}"</span>,</span>
<span id="cb9-350"><a href="#cb9-350" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">sigma_{4}"</span>,</span>
<span id="cb9-351"><a href="#cb9-351" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">sigma_{21}"</span>,</span>
<span id="cb9-352"><a href="#cb9-352" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">sigma_{6}"</span>,</span>
<span id="cb9-353"><a href="#cb9-353" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">sigma_{</span><span class="sc">\\</span><span class="st">beta}"</span>,</span>
<span id="cb9-354"><a href="#cb9-354" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\\</span><span class="st">sigma_{10}"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-355"><a href="#cb9-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_equation</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-356"><a href="#cb9-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_paragraph</span>()</span>
<span id="cb9-357"><a href="#cb9-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-358"><a href="#cb9-358" aria-hidden="true" tabindex="-1"></a><span class="co"># flextable generation</span></span>
<span id="cb9-359"><a href="#cb9-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-360"><a href="#cb9-360" aria-hidden="true" tabindex="-1"></a>relative_parameter_variations_flextable <span class="ot">&lt;-</span> <span class="fu">flextable</span>(relative_parameter_per_cluster) <span class="sc">|&gt;</span> </span>
<span id="cb9-361"><a href="#cb9-361" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add gradient colouring based on values</span></span>
<span id="cb9-362"><a href="#cb9-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bg</span>(</span>
<span id="cb9-363"><a href="#cb9-363" aria-hidden="true" tabindex="-1"></a>    <span class="at">j =</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(variable_labels), <span class="st">"cluster"</span>), </span>
<span id="cb9-364"><a href="#cb9-364" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg =</span> colourer) <span class="sc">|&gt;</span> </span>
<span id="cb9-365"><a href="#cb9-365" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Format numbers (optional for consistent display)</span></span>
<span id="cb9-366"><a href="#cb9-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colformat_double</span>(<span class="at">j =</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(variable_labels), <span class="st">"cluster"</span>),</span>
<span id="cb9-367"><a href="#cb9-367" aria-hidden="true" tabindex="-1"></a>                   <span class="at">suffix =</span> <span class="st">"%"</span>,</span>
<span id="cb9-368"><a href="#cb9-368" aria-hidden="true" tabindex="-1"></a>                   <span class="at">big.mark =</span> <span class="st">","</span>, </span>
<span id="cb9-369"><a href="#cb9-369" aria-hidden="true" tabindex="-1"></a>                   <span class="at">digits =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-370"><a href="#cb9-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">append_chunks</span>(<span class="at">j =</span> <span class="st">"cluster"</span>,</span>
<span id="cb9-371"><a href="#cb9-371" aria-hidden="true" tabindex="-1"></a>                <span class="co"># what to append</span></span>
<span id="cb9-372"><a href="#cb9-372" aria-hidden="true" tabindex="-1"></a>                <span class="fu">as_equation</span>(<span class="fu">c</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">text{Th1}</span><span class="sc">\\</span><span class="st">uparrow </span><span class="sc">\\</span><span class="st">text{Th2}</span><span class="sc">\\</span><span class="st">downarrow"</span>,</span>
<span id="cb9-373"><a href="#cb9-373" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"</span><span class="sc">\\</span><span class="st">text{Th1}</span><span class="sc">\\</span><span class="st">downarrow </span><span class="sc">\\</span><span class="st">text{Th2}</span><span class="sc">\\</span><span class="st">uparrow"</span>, </span>
<span id="cb9-374"><a href="#cb9-374" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"</span><span class="sc">\\</span><span class="st">text{Th1}</span><span class="sc">\\</span><span class="st">uparrow </span><span class="sc">\\</span><span class="st">text{Th2}</span><span class="sc">\\</span><span class="st">uparrow"</span>,</span>
<span id="cb9-375"><a href="#cb9-375" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"</span><span class="sc">\\</span><span class="st">text{Th1}</span><span class="sc">\\</span><span class="st">downarrow </span><span class="sc">\\</span><span class="st">text{Th2}</span><span class="sc">\\</span><span class="st">downarrow"</span>))</span>
<span id="cb9-376"><a href="#cb9-376" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb9-377"><a href="#cb9-377" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename columns using LaTeX-like notation</span></span>
<span id="cb9-378"><a href="#cb9-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_header_labels</span>(<span class="at">values =</span> variable_labels</span>
<span id="cb9-379"><a href="#cb9-379" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb9-380"><a href="#cb9-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_row</span>(<span class="at">values =</span> header_row,</span>
<span id="cb9-381"><a href="#cb9-381" aria-hidden="true" tabindex="-1"></a>                 <span class="at">colwidths =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">11</span>), <span class="at">top =</span> <span class="cn">FALSE</span></span>
<span id="cb9-382"><a href="#cb9-382" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb9-383"><a href="#cb9-383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">align</span>(<span class="at">align =</span> <span class="st">"center"</span>, <span class="at">part =</span> <span class="st">"all"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-384"><a href="#cb9-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_caption</span>(<span class="st">"Table 8: Parameter variations in different types of diseases. </span></span>
<span id="cb9-385"><a href="#cb9-385" aria-hidden="true" tabindex="-1"></a><span class="st">              In blue, disease subtype induces shrinkage of the coefficients, </span></span>
<span id="cb9-386"><a href="#cb9-386" aria-hidden="true" tabindex="-1"></a><span class="st">              while red values correspond to increased parameter uptakes. "</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-387"><a href="#cb9-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge_at</span>(<span class="at">part =</span> <span class="st">"head"</span>, <span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">j=</span> <span class="dv">1</span>)</span>
<span id="cb9-388"><a href="#cb9-388" aria-hidden="true" tabindex="-1"></a>relative_parameter_variations_flextable</span>
<span id="cb9-389"><a href="#cb9-389" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-390"><a href="#cb9-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-391"><a href="#cb9-391" aria-hidden="true" tabindex="-1"></a>One of the major advantages of <span class="in">`flextable`</span> lies in its ability to save the generated flextable object in a variety of formats, including <span class="in">`docx`</span>, and <span class="in">`html`</span>, as illustrated in @lst-flextable-output (or even several ones simultaneously).</span>
<span id="cb9-392"><a href="#cb9-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-395"><a href="#cb9-395" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-396"><a href="#cb9-396" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: flextable-output</span></span>
<span id="cb9-397"><a href="#cb9-397" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb9-398"><a href="#cb9-398" aria-hidden="true" tabindex="-1"></a><span class="co">#| lst-label: lst-flextable-output</span></span>
<span id="cb9-399"><a href="#cb9-399" aria-hidden="true" tabindex="-1"></a><span class="co">#| lst-cap: Flextable multiple outputs.</span></span>
<span id="cb9-400"><a href="#cb9-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-401"><a href="#cb9-401" aria-hidden="true" tabindex="-1"></a><span class="fu">save_as_html</span>(relative_parameter_variations_flextable,</span>
<span id="cb9-402"><a href="#cb9-402" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">"../../results/Table8.html"</span>,</span>
<span id="cb9-403"><a href="#cb9-403" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Table 8: Parameter variations per disease subtype."</span></span>
<span id="cb9-404"><a href="#cb9-404" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-405"><a href="#cb9-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-406"><a href="#cb9-406" aria-hidden="true" tabindex="-1"></a><span class="fu">save_as_docx</span>(relative_parameter_variations_flextable,</span>
<span id="cb9-407"><a href="#cb9-407" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">"../../results/Table8.docx"</span>,</span>
<span id="cb9-408"><a href="#cb9-408" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Table 8: Parameter variations per disease subtype."</span></span>
<span id="cb9-409"><a href="#cb9-409" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-410"><a href="#cb9-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-411"><a href="#cb9-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-412"><a href="#cb9-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-413"><a href="#cb9-413" aria-hidden="true" tabindex="-1"></a><span class="fu">## Treatment outcome and patient stratification</span></span>
<span id="cb9-414"><a href="#cb9-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-415"><a href="#cb9-415" aria-hidden="true" tabindex="-1"></a>The objective of this section is to predict the efficiency of a novel anti-TNF-$\alpha$ treatment, assuming that the blocking treatment is equivalent to force the concentration of TNF-$\alpha$ to remain zero, and calculate the change of other variables at the **steady-state concentrations**. </span>
<span id="cb9-416"><a href="#cb9-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-417"><a href="#cb9-417" aria-hidden="true" tabindex="-1"></a>Second objective is to determine the efficiency of the treatment conditionned to the *patient endotype* determined using *patient stratification* approaches. </span>
<span id="cb9-418"><a href="#cb9-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-419"><a href="#cb9-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-420"><a href="#cb9-420" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load Free Parameter variations in different types of diseases</span></span>
<span id="cb9-421"><a href="#cb9-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-422"><a href="#cb9-422" aria-hidden="true" tabindex="-1"></a>**Since the results of parameter estimation reported in @sec-parameter-estimation differ significantly from the results reported in the original paper, *Table 8*, [@lo2016po, pp. 13](https://journals.plos.org/plosone/article/figure?id=10.1371/journal.pone.0165782.t008), we directly retrieve in that section the original estimates from @lo2016po**.</span>
<span id="cb9-423"><a href="#cb9-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-426"><a href="#cb9-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-427"><a href="#cb9-427" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-parameter-variations</span></span>
<span id="cb9-428"><a href="#cb9-428" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb9-429"><a href="#cb9-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-430"><a href="#cb9-430" aria-hidden="true" tabindex="-1"></a><span class="do">## Prepare parameter variations for each of the four patient subtypes ----</span></span>
<span id="cb9-431"><a href="#cb9-431" aria-hidden="true" tabindex="-1"></a>healthy_model <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">loadModel</span>(<span class="st">"../../models/team_2016_final_model_lo2016_2025_05_13.cps"</span>))</span>
<span id="cb9-432"><a href="#cb9-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-433"><a href="#cb9-433" aria-hidden="true" tabindex="-1"></a><span class="co"># retrieve parameter mapping</span></span>
<span id="cb9-434"><a href="#cb9-434" aria-hidden="true" tabindex="-1"></a>parameters_per_clusters <span class="ot">&lt;-</span> <span class="fu">getParameters</span>(<span class="fu">c</span>(<span class="st">"(Prod of Ig from T1).k1"</span>,</span>
<span id="cb9-435"><a href="#cb9-435" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Prod of Ia from T1).k1"</span>,</span>
<span id="cb9-436"><a href="#cb9-436" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Prod of Ib from Tr).k1"</span>,</span>
<span id="cb9-437"><a href="#cb9-437" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Prod of I10 from Tr).v10r"</span>,</span>
<span id="cb9-438"><a href="#cb9-438" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Induction of T1 from M).s12"</span>,</span>
<span id="cb9-439"><a href="#cb9-439" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Induction of T2).s4"</span>,</span>
<span id="cb9-440"><a href="#cb9-440" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Induction of T17).s21"</span>,</span>
<span id="cb9-441"><a href="#cb9-441" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Induction of T17).s6"</span>,</span>
<span id="cb9-442"><a href="#cb9-442" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Induction of Tr).sb"</span>,</span>
<span id="cb9-443"><a href="#cb9-443" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"(Induction of Tr).s10"</span>), <span class="at">model =</span> healthy_model)</span>
<span id="cb9-444"><a href="#cb9-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-445"><a href="#cb9-445" aria-hidden="true" tabindex="-1"></a><span class="co"># retrieve parameter variations specific to each disease subtype ...</span></span>
<span id="cb9-446"><a href="#cb9-446" aria-hidden="true" tabindex="-1"></a>patient_group <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Type1"</span>, <span class="st">"Type2"</span>, <span class="st">"Type3"</span>, <span class="st">"Type4"</span>)</span>
<span id="cb9-447"><a href="#cb9-447" aria-hidden="true" tabindex="-1"></a>parameters_per_clusters <span class="ot">&lt;-</span> parameters_per_clusters <span class="sc">|&gt;</span> </span>
<span id="cb9-448"><a href="#cb9-448" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"../../data/IBD subgroups.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>), <span class="at">by =</span> <span class="st">"key"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-449"><a href="#cb9-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">healthy =</span> value) <span class="sc">|&gt;</span> </span>
<span id="cb9-450"><a href="#cb9-450" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>mapping) <span class="sc">|&gt;</span> </span>
<span id="cb9-451"><a href="#cb9-451" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ... and convert relative ratios to absolute</span></span>
<span id="cb9-452"><a href="#cb9-452" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(patient_group), \(x) healthy <span class="sc">*</span>  (<span class="dv">1</span> <span class="sc">+</span> x<span class="sc">/</span><span class="dv">100</span>)))</span>
<span id="cb9-453"><a href="#cb9-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-454"><a href="#cb9-454" aria-hidden="true" tabindex="-1"></a><span class="co"># run healthy steady state</span></span>
<span id="cb9-455"><a href="#cb9-455" aria-hidden="true" tabindex="-1"></a>healthy_steaty_state <span class="ot">&lt;-</span> <span class="fu">runSteadyState</span>(</span>
<span id="cb9-456"><a href="#cb9-456" aria-hidden="true" tabindex="-1"></a>  <span class="at">calculate_jacobian =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-457"><a href="#cb9-457" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> healthy_model)<span class="sc">$</span>species <span class="sc">|&gt;</span> </span>
<span id="cb9-458"><a href="#cb9-458" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name, <span class="at">concentrationH =</span> concentration) <span class="sc">|&gt;</span> </span>
<span id="cb9-459"><a href="#cb9-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"I6"</span>, <span class="st">"I10"</span>, <span class="st">"Ia"</span>, <span class="st">"T1"</span>, <span class="st">"T2"</span>,<span class="st">"T17"</span>, <span class="st">"Tr"</span>, <span class="st">"Ig"</span>, <span class="st">"Ib"</span>))</span>
<span id="cb9-460"><a href="#cb9-460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-461"><a href="#cb9-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-462"><a href="#cb9-462" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model the effect of TNF-alpha blockade</span></span>
<span id="cb9-463"><a href="#cb9-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-466"><a href="#cb9-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-467"><a href="#cb9-467" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: model-tnf-blockade</span></span>
<span id="cb9-468"><a href="#cb9-468" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb9-469"><a href="#cb9-469" aria-hidden="true" tabindex="-1"></a><span class="co"># Infer steady states for each patient subgroup, with and without anti-TNF-alpha treatment ----</span></span>
<span id="cb9-470"><a href="#cb9-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-471"><a href="#cb9-471" aria-hidden="true" tabindex="-1"></a>steady_states_per_cluster <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(patient_group, <span class="cf">function</span>(cluster) {</span>
<span id="cb9-472"><a href="#cb9-472" aria-hidden="true" tabindex="-1"></a>  disease_model_without_treatment <span class="ot">&lt;-</span> healthy_model <span class="sc">|&gt;</span> <span class="fu">saveModelToString</span>() <span class="sc">|&gt;</span>  <span class="fu">loadModelFromString</span>()</span>
<span id="cb9-473"><a href="#cb9-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setParameters</span>(<span class="at">model =</span> disease_model_without_treatment, </span>
<span id="cb9-474"><a href="#cb9-474" aria-hidden="true" tabindex="-1"></a>                <span class="at">key =</span> parameters_per_clusters<span class="sc">$</span>key, </span>
<span id="cb9-475"><a href="#cb9-475" aria-hidden="true" tabindex="-1"></a>                <span class="at">value =</span> parameters_per_clusters[[cluster]])</span>
<span id="cb9-476"><a href="#cb9-476" aria-hidden="true" tabindex="-1"></a>  <span class="co"># without anti-TNF alpha treatment</span></span>
<span id="cb9-477"><a href="#cb9-477" aria-hidden="true" tabindex="-1"></a>  without_treatment_steady_state <span class="ot">&lt;-</span> <span class="fu">runSteadyState</span>(</span>
<span id="cb9-478"><a href="#cb9-478" aria-hidden="true" tabindex="-1"></a>    <span class="at">calculate_jacobian =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-479"><a href="#cb9-479" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> disease_model_without_treatment)<span class="sc">$</span>species <span class="sc">|&gt;</span> </span>
<span id="cb9-480"><a href="#cb9-480" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(name, concentration) <span class="sc">|&gt;</span> </span>
<span id="cb9-481"><a href="#cb9-481" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(healthy_steaty_state, <span class="at">by =</span> <span class="st">"name"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-482"><a href="#cb9-482" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span> (<span class="at">concentration =</span> <span class="dv">100</span><span class="sc">*</span> (concentration <span class="sc">-</span> concentrationH) <span class="sc">/</span> concentrationH) <span class="sc">|&gt;</span> </span>
<span id="cb9-483"><a href="#cb9-483" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>concentrationH) <span class="sc">|&gt;</span> </span>
<span id="cb9-484"><a href="#cb9-484" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cluster =</span> cluster, <span class="at">category =</span> <span class="st">"untreated"</span>) </span>
<span id="cb9-485"><a href="#cb9-485" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-486"><a href="#cb9-486" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-487"><a href="#cb9-487" aria-hidden="true" tabindex="-1"></a>  <span class="co"># with anti-TNF alpha treatment</span></span>
<span id="cb9-488"><a href="#cb9-488" aria-hidden="true" tabindex="-1"></a>  disease_model_with_treatment <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(disease_model_without_treatment <span class="sc">|&gt;</span> </span>
<span id="cb9-489"><a href="#cb9-489" aria-hidden="true" tabindex="-1"></a>                                                     <span class="fu">saveModelToString</span>() <span class="sc">|&gt;</span>  </span>
<span id="cb9-490"><a href="#cb9-490" aria-hidden="true" tabindex="-1"></a>                                                     <span class="fu">loadModelFromString</span>())</span>
<span id="cb9-491"><a href="#cb9-491" aria-hidden="true" tabindex="-1"></a>  <span class="co"># to that end, coerce TNF-alpha to remain fixed and null throughout the whole process</span></span>
<span id="cb9-492"><a href="#cb9-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setSpecies</span>(</span>
<span id="cb9-493"><a href="#cb9-493" aria-hidden="true" tabindex="-1"></a>    <span class="at">key =</span> <span class="st">"Ia{compartment}"</span>,</span>
<span id="cb9-494"><a href="#cb9-494" aria-hidden="true" tabindex="-1"></a>    <span class="at">initial_concentration =</span> <span class="dv">0</span>,</span>
<span id="cb9-495"><a href="#cb9-495" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span><span class="st">"fixed"</span>,</span>
<span id="cb9-496"><a href="#cb9-496" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> disease_model_with_treatment</span>
<span id="cb9-497"><a href="#cb9-497" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-498"><a href="#cb9-498" aria-hidden="true" tabindex="-1"></a>  with_treatment_steady_state <span class="ot">&lt;-</span> <span class="fu">runSteadyState</span>(</span>
<span id="cb9-499"><a href="#cb9-499" aria-hidden="true" tabindex="-1"></a>    <span class="at">calculate_jacobian =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-500"><a href="#cb9-500" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> disease_model_with_treatment)<span class="sc">$</span>species <span class="sc">|&gt;</span> </span>
<span id="cb9-501"><a href="#cb9-501" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(name, concentration) <span class="sc">|&gt;</span> </span>
<span id="cb9-502"><a href="#cb9-502" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(healthy_steaty_state, <span class="at">by =</span> <span class="st">"name"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-503"><a href="#cb9-503" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span> (<span class="at">concentration =</span> <span class="dv">100</span><span class="sc">*</span> (concentration <span class="sc">-</span> concentrationH) <span class="sc">/</span> concentrationH) <span class="sc">|&gt;</span> </span>
<span id="cb9-504"><a href="#cb9-504" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>concentrationH) <span class="sc">|&gt;</span> </span>
<span id="cb9-505"><a href="#cb9-505" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">add_row</span>(<span class="at">name =</span> <span class="st">"Ia"</span>, <span class="at">concentration =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-506"><a href="#cb9-506" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cluster =</span> cluster, <span class="at">category =</span> <span class="st">"treated"</span>)</span>
<span id="cb9-507"><a href="#cb9-507" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-508"><a href="#cb9-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="fu">rbind</span>(without_treatment_steady_state, with_treatment_steady_state))</span>
<span id="cb9-509"><a href="#cb9-509" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-510"><a href="#cb9-510" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span> </span>
<span id="cb9-511"><a href="#cb9-511" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb9-512"><a href="#cb9-512" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-513"><a href="#cb9-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-514"><a href="#cb9-514" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb9-515"><a href="#cb9-515" aria-hidden="true" tabindex="-1"></a>steady_states_per_cluster <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(patient_group, <span class="cf">function</span>(cluster) {</span>
<span id="cb9-516"><a href="#cb9-516" aria-hidden="true" tabindex="-1"></a>  <span class="co"># without anti-TNF alpha treatment</span></span>
<span id="cb9-517"><a href="#cb9-517" aria-hidden="true" tabindex="-1"></a>  disease_model_without_treatment <span class="ot">&lt;-</span> healthy_model <span class="sc">|&gt;</span> <span class="fu">saveModelToString</span>() <span class="sc">|&gt;</span>  <span class="fu">loadModelFromString</span>() <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-518"><a href="#cb9-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setParameters</span>(<span class="at">model =</span> disease_model_without_treatment,  <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-519"><a href="#cb9-519" aria-hidden="true" tabindex="-1"></a>                <span class="at">key =</span> parameters_per_clusters<span class="sc">$</span>key, <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-520"><a href="#cb9-520" aria-hidden="true" tabindex="-1"></a>                <span class="at">value =</span> parameters_per_clusters[[cluster]])  <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-521"><a href="#cb9-521" aria-hidden="true" tabindex="-1"></a>  without_treatment_steady_state <span class="ot">&lt;-</span> <span class="fu">runSteadyState</span>(  <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-522"><a href="#cb9-522" aria-hidden="true" tabindex="-1"></a>    <span class="at">calculate_jacobian =</span> <span class="cn">FALSE</span>, <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-523"><a href="#cb9-523" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> disease_model_without_treatment)<span class="sc">$</span>species <span class="sc">|&gt;</span> <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-524"><a href="#cb9-524" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(name, concentration) <span class="sc">|&gt;</span>  <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-525"><a href="#cb9-525" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(healthy_steaty_state, <span class="at">by =</span> <span class="st">"name"</span>) <span class="sc">|&gt;</span>  <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-526"><a href="#cb9-526" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span> (<span class="at">concentration =</span> <span class="dv">100</span><span class="sc">*</span> (concentration <span class="sc">-</span> concentrationH) <span class="sc">/</span> concentrationH) <span class="sc">|&gt;</span> <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-527"><a href="#cb9-527" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>concentrationH) <span class="sc">|&gt;</span> <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-528"><a href="#cb9-528" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cluster =</span> cluster, <span class="at">category =</span> <span class="st">"untreated"</span>) <span class="co"># &lt;1&gt;</span></span>
<span id="cb9-529"><a href="#cb9-529" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-530"><a href="#cb9-530" aria-hidden="true" tabindex="-1"></a>  <span class="co"># with anti-TNF alpha treatment</span></span>
<span id="cb9-531"><a href="#cb9-531" aria-hidden="true" tabindex="-1"></a>  disease_model_with_treatment <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(disease_model_without_treatment <span class="sc">|&gt;</span> </span>
<span id="cb9-532"><a href="#cb9-532" aria-hidden="true" tabindex="-1"></a>                                                     <span class="fu">saveModelToString</span>() <span class="sc">|&gt;</span>  </span>
<span id="cb9-533"><a href="#cb9-533" aria-hidden="true" tabindex="-1"></a>                                                     <span class="fu">loadModelFromString</span>())</span>
<span id="cb9-534"><a href="#cb9-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setSpecies</span>(<span class="at">key =</span> <span class="st">"Ia{compartment}"</span>, <span class="co"># &lt;2&gt;</span></span>
<span id="cb9-535"><a href="#cb9-535" aria-hidden="true" tabindex="-1"></a>             <span class="at">initial_concentration =</span> <span class="dv">0</span>, <span class="co"># &lt;2&gt;</span></span>
<span id="cb9-536"><a href="#cb9-536" aria-hidden="true" tabindex="-1"></a>             <span class="at">type =</span><span class="st">"fixed"</span>, <span class="co"># &lt;2&gt;</span></span>
<span id="cb9-537"><a href="#cb9-537" aria-hidden="true" tabindex="-1"></a>             <span class="at">model =</span> disease_model_with_treatment) <span class="co"># &lt;2&gt;</span></span>
<span id="cb9-538"><a href="#cb9-538" aria-hidden="true" tabindex="-1"></a>  with_treatment_steady_state <span class="ot">&lt;-</span> <span class="fu">runSteadyState</span>( <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-539"><a href="#cb9-539" aria-hidden="true" tabindex="-1"></a>    <span class="at">calculate_jacobian =</span> <span class="cn">FALSE</span>, <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-540"><a href="#cb9-540" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> disease_model_with_treatment)<span class="sc">$</span>species <span class="sc">|&gt;</span> <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-541"><a href="#cb9-541" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(name, concentration) <span class="sc">|&gt;</span> <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-542"><a href="#cb9-542" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(healthy_steaty_state, <span class="at">by =</span> <span class="st">"name"</span>) <span class="sc">|&gt;</span> <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-543"><a href="#cb9-543" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span> (<span class="at">concentration =</span> <span class="dv">100</span><span class="sc">*</span> (concentration <span class="sc">-</span> concentrationH) <span class="sc">/</span> concentrationH) <span class="sc">|&gt;</span> <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-544"><a href="#cb9-544" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>concentrationH) <span class="sc">|&gt;</span> <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-545"><a href="#cb9-545" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">add_row</span>(<span class="at">name =</span> <span class="st">"Ia"</span>, <span class="at">concentration =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-546"><a href="#cb9-546" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cluster =</span> cluster, <span class="at">category =</span> <span class="st">"treated"</span>) <span class="co"># &lt;3&gt;</span></span>
<span id="cb9-547"><a href="#cb9-547" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-548"><a href="#cb9-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="fu">rbind</span>(without_treatment_steady_state, with_treatment_steady_state))</span>
<span id="cb9-549"><a href="#cb9-549" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-550"><a href="#cb9-550" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="co"># &lt;4&gt;</span></span>
<span id="cb9-551"><a href="#cb9-551" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-552"><a href="#cb9-552" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Estimate *steady-state* conditions for each of the four patient subgroups identified, without anti-TNF-$\alpha$ treatment.</span>
<span id="cb9-553"><a href="#cb9-553" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Constrain TNF-$\alpha$ to remain <span class="in">`fixed`</span> and **null** by setting the initial concentration level to $0$. **Both parameters are required** to ensure absence of TNF-$\alpha$.</span>
<span id="cb9-554"><a href="#cb9-554" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Predict the new *steady-state* conditions after therapeutic treatment. </span>
<span id="cb9-555"><a href="#cb9-555" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span><span class="in">`dplyr::bind_rows()`</span> merges a list of <span class="in">`data.frame`</span> into a single one. </span>
<span id="cb9-556"><a href="#cb9-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-557"><a href="#cb9-557" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simulation visualisations of the fold changes of the cytokine and T cell concentrations</span></span>
<span id="cb9-558"><a href="#cb9-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-559"><a href="#cb9-559" aria-hidden="true" tabindex="-1"></a>We have reproduced *Fig.3* from @lo2016po, pp. 13, in @fig-treatment-blockade, using a combination of <span class="in">`ggplot2`</span>for individual barplot representations and <span class="in">`cowplot`</span> for individual 'ggplot' concatenations. </span>
<span id="cb9-560"><a href="#cb9-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-563"><a href="#cb9-563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-564"><a href="#cb9-564" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: true</span></span>
<span id="cb9-565"><a href="#cb9-565" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-treatment-blockade</span></span>
<span id="cb9-566"><a href="#cb9-566" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Simulation results of the **fold changes** of the cytokine and T-cell concentrations when TNF-$\alpha$ is completely blocked in the four group of identified patients. Blue bars represent the results of pre-treatment; red bars represent the results of post-treatment with TNF-$\alpha$ blockage. Reproduction of [@lo2016po, pp. 13], Fig.3. </span></span>
<span id="cb9-567"><a href="#cb9-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-568"><a href="#cb9-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-569"><a href="#cb9-569" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproduce boxplots of Figure 3, pre and post-treatment ----</span></span>
<span id="cb9-570"><a href="#cb9-570" aria-hidden="true" tabindex="-1"></a><span class="co"># Format dataset for plotting</span></span>
<span id="cb9-571"><a href="#cb9-571" aria-hidden="true" tabindex="-1"></a>steady_states_per_cluster_plot <span class="ot">&lt;-</span> steady_states_per_cluster <span class="sc">|&gt;</span> </span>
<span id="cb9-572"><a href="#cb9-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> (<span class="at">name =</span> <span class="fu">factor</span> (name, </span>
<span id="cb9-573"><a href="#cb9-573" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"I6"</span>, <span class="st">"I10"</span>, <span class="st">"Ia"</span>,  <span class="st">"T1"</span>, <span class="st">"T2"</span>,</span>
<span id="cb9-574"><a href="#cb9-574" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"T17"</span>, <span class="st">"Tr"</span>, <span class="st">"Ig"</span>, <span class="st">"Ib"</span>),</span>
<span id="cb9-575"><a href="#cb9-575" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"IL-6"</span>, <span class="st">"IL-10"</span>, <span class="st">"TNF-alpha"</span>, <span class="st">"Th1"</span>, <span class="st">"Th2"</span>, </span>
<span id="cb9-576"><a href="#cb9-576" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Th17"</span>, <span class="st">"Treg"</span>, <span class="st">"IFN-gamma"</span>, <span class="st">"TFG-beta"</span>), </span>
<span id="cb9-577"><a href="#cb9-577" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ordered =</span> <span class="cn">TRUE</span>),</span>
<span id="cb9-578"><a href="#cb9-578" aria-hidden="true" tabindex="-1"></a>          <span class="at">category  =</span> <span class="fu">factor</span>(category, </span>
<span id="cb9-579"><a href="#cb9-579" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"untreated"</span>, <span class="st">"treated"</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span>
<span id="cb9-580"><a href="#cb9-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-581"><a href="#cb9-581" aria-hidden="true" tabindex="-1"></a>cluster_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Type 1: Th1</span><span class="sc">\\</span><span class="st">uparrow Th2</span><span class="sc">\\</span><span class="st">downarrow"</span>,</span>
<span id="cb9-582"><a href="#cb9-582" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Type 2: Th1</span><span class="sc">\\</span><span class="st">downarrow Th2</span><span class="sc">\\</span><span class="st">uparrow"</span>, </span>
<span id="cb9-583"><a href="#cb9-583" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Type 3: Th1</span><span class="sc">\\</span><span class="st">uparrow Th2</span><span class="sc">\\</span><span class="st">uparrow"</span>,</span>
<span id="cb9-584"><a href="#cb9-584" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Type 4: Th1</span><span class="sc">\\</span><span class="st">downarrow Th2</span><span class="sc">\\</span><span class="st">downarrow"</span>) </span>
<span id="cb9-585"><a href="#cb9-585" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cluster_labels) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Type1"</span>, <span class="st">"Type2"</span>, <span class="st">"Type3"</span>, <span class="st">"Type4"</span>)</span>
<span id="cb9-586"><a href="#cb9-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-587"><a href="#cb9-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-588"><a href="#cb9-588" aria-hidden="true" tabindex="-1"></a><span class="do">### Retrieve legend ----</span></span>
<span id="cb9-589"><a href="#cb9-589" aria-hidden="true" tabindex="-1"></a>global_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> steady_states_per_cluster_plot, </span>
<span id="cb9-590"><a href="#cb9-590" aria-hidden="true" tabindex="-1"></a>                      <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> concentration, <span class="at">fill =</span> category)) <span class="sc">+</span></span>
<span id="cb9-591"><a href="#cb9-591" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb9-592"><a href="#cb9-592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span><span class="st">"Treatment"</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>)) <span class="sc">+</span> </span>
<span id="cb9-593"><a href="#cb9-593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb9-594"><a href="#cb9-594" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) </span>
<span id="cb9-595"><a href="#cb9-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-596"><a href="#cb9-596" aria-hidden="true" tabindex="-1"></a><span class="do">### Generate bar plot for each disease subtype ----</span></span>
<span id="cb9-597"><a href="#cb9-597" aria-hidden="true" tabindex="-1"></a>list_plots <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">imap</span>(cluster_labels, <span class="sc">~</span> <span class="fu">ggplot</span>(<span class="at">data =</span> steady_states_per_cluster_plot <span class="sc">|&gt;</span> <span class="fu">filter</span>(cluster<span class="sc">==</span>.y), </span>
<span id="cb9-598"><a href="#cb9-598" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> concentration, <span class="at">fill =</span> category)) <span class="sc">+</span></span>
<span id="cb9-599"><a href="#cb9-599" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>)<span class="sc">+</span></span>
<span id="cb9-600"><a href="#cb9-600" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb9-601"><a href="#cb9-601" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">scale_fill_manual</span>(<span class="at">name =</span><span class="st">"Treatment"</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb9-602"><a href="#cb9-602" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-603"><a href="#cb9-603" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-604"><a href="#cb9-604" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb9-605"><a href="#cb9-605" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ggtitle</span>(<span class="fu">TeX</span>(.x)))</span>
<span id="cb9-606"><a href="#cb9-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-607"><a href="#cb9-607" aria-hidden="true" tabindex="-1"></a><span class="do">### Combine barplots into a 2x2 grid ----</span></span>
<span id="cb9-608"><a href="#cb9-608" aria-hidden="true" tabindex="-1"></a>plot_grid_combined <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> list_plots, </span>
<span id="cb9-609"><a href="#cb9-609" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">align =</span> <span class="st">"hv"</span>, <span class="at">axis =</span> <span class="st">"tblr"</span>) </span>
<span id="cb9-610"><a href="#cb9-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-611"><a href="#cb9-611" aria-hidden="true" tabindex="-1"></a>x_label <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span> <span class="fu">draw_label</span>(<span class="st">"Cell Species"</span>, <span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fl">0.5</span>)</span>
<span id="cb9-612"><a href="#cb9-612" aria-hidden="true" tabindex="-1"></a>y_label <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span> <span class="fu">draw_label</span>(<span class="st">"ODE Parameters"</span>, <span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">y =</span> <span class="fl">0.5</span>, <span class="at">angle =</span> <span class="dv">90</span>)</span>
<span id="cb9-613"><a href="#cb9-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-614"><a href="#cb9-614" aria-hidden="true" tabindex="-1"></a><span class="co"># Add global y label</span></span>
<span id="cb9-615"><a href="#cb9-615" aria-hidden="true" tabindex="-1"></a>plot_grid_combined <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(y_label,</span>
<span id="cb9-616"><a href="#cb9-616" aria-hidden="true" tabindex="-1"></a>  plot_grid_combined,</span>
<span id="cb9-617"><a href="#cb9-617" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb9-618"><a href="#cb9-618" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>)  <span class="co"># Adjust width for the legend</span></span>
<span id="cb9-619"><a href="#cb9-619" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-620"><a href="#cb9-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-621"><a href="#cb9-621" aria-hidden="true" tabindex="-1"></a>legend_plot <span class="ot">&lt;-</span> <span class="fu">get_legend_temp</span>(global_plot)</span>
<span id="cb9-622"><a href="#cb9-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-623"><a href="#cb9-623" aria-hidden="true" tabindex="-1"></a><span class="co"># Add global x label</span></span>
<span id="cb9-624"><a href="#cb9-624" aria-hidden="true" tabindex="-1"></a>plot_grid_combined <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(plot_grid_combined, </span>
<span id="cb9-625"><a href="#cb9-625" aria-hidden="true" tabindex="-1"></a>                   x_label,</span>
<span id="cb9-626"><a href="#cb9-626" aria-hidden="true" tabindex="-1"></a>                   legend_plot,</span>
<span id="cb9-627"><a href="#cb9-627" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span><span class="dv">1</span>,</span>
<span id="cb9-628"><a href="#cb9-628" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>)  <span class="co"># Adjust width for the legend</span></span>
<span id="cb9-629"><a href="#cb9-629" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-630"><a href="#cb9-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-631"><a href="#cb9-631" aria-hidden="true" tabindex="-1"></a>plot_grid_combined <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(</span>
<span id="cb9-632"><a href="#cb9-632" aria-hidden="true" tabindex="-1"></a>  plot_grid_combined,</span>
<span id="cb9-633"><a href="#cb9-633" aria-hidden="true" tabindex="-1"></a>  legend_plot,</span>
<span id="cb9-634"><a href="#cb9-634" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb9-635"><a href="#cb9-635" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>)  <span class="co"># Adjust width for the legend</span></span>
<span id="cb9-636"><a href="#cb9-636" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-637"><a href="#cb9-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-638"><a href="#cb9-638" aria-hidden="true" tabindex="-1"></a>plot_grid_combined</span>
<span id="cb9-639"><a href="#cb9-639" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-640"><a href="#cb9-640" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Powered by <a href="https://quarto.org"><iconify-icon role="img" inline="" icon="simple-icons:quarto" aria-label="Icon quarto from simple-icons Iconify.design set." title="Icon quarto from simple-icons Iconify.design set."></iconify-icon> Quarto</a>.</p>
</div>   
    <div class="nav-footer-center">
<p>© <span id="current-year"></span> Bastien CHASSAGNOL.</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/bastienchassagnol//COPASI_Team216_Lo2016/edit/master/reproducibility/patient_stratification.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/bastienchassagnol//COPASI_Team216_Lo2016/blob/master/reproducibility/patient_stratification.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/bastienchassagnol//COPASI_Team216_Lo2016/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>License: <a href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY NC SA 4.0</a>.</p>
</div>
  </div>
</footer>




</body></html>